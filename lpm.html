<!doctype html>
                     <head>
                     <meta charset="utf-8">
                     <style>
                        body {
                            text-align: justify;
                  
                            position: absolute;
                            width: 70%;
                            left: 15%;
                            top: 20px;
                            padding-bottom: 100px;
                      
                        }
                        h1 {
                            font-size: 2.0em;
                        }
                        h2 {
                            font-size: 1.8em;
                        }
                        h3 {
                            font-size: 1.6em;
                        }
                        h4 {
                            font-size: 1.4em;
                        }
                        h5 {
                            font-size: 1.2em;
                        }
                        h6 {
                            font-size: 1.0em;
                        }
                        sup {
                            font-size: 0.7em;
                        }
                        header {
                            border: 2px solid black;
                            padding: 40px;
                            margin-bottom: 40px;
                        }
                        header div {
                            text-align: center;
                            font-size: 3.0em;
                        }
                        .authors {
                            font-style: italic;
                            text-align: center;
                            margin: 5px;
                        }
                        .codetype {
                            color: #888;
                            text-align: center;
                            margin: 5px;
                        }
                        .abstract {
                        
                            width: 90%;
                            position: relative;
                            left: 5%;
                      
                            margin-top: 40px;
                            margin-bottom: 40px;
                        }
                        .abstract h1 {
                            text-align: center;
                        }
                        .license {
                        
                            width: 90%;
                            position: relative;
                            left: 5%;
                      
                            margin-top: 40px;
                            margin-bottom: 40px;
                        }
                        .license h1 {
                            text-align: center;
                        }
                        .warning {
                            border: 2px solid #88f;
                            padding: 5px;
                            padding-left: 20px;
                            padding-right: 20px;
                            border-radius: 10px 10px;
                            background-color: #ddf;
                            margin-bottom: 10px;
                        }
                        .bold {
                            font-weight: bold;
                        }
                        .italic {
                            font-style: italic;
                        }
                        .underline {
                            text-decoration: underline;
                        }
                        .overline {
                            text-decoration: line-through;
                        }
                        .img {
                            text-align: center;
                        }
                        .toc {
                  
                            width: 70%;
                            position: relative;
                            left: 15%;
                     
                            padding: 20px;
                            border: 2px solid black;
                            border-radius: 2px;
                            margin-bottom: 40px;
                        }
                        .toc h1 {
                            text-align: center;
                        }
                        pre {
                            margin: 0px;
                            white-space: pre-wrap;
                        }
                        .codechunk {
                            border: 1px solid #fda;
                            border-radius: 10px;
                            background-color: #ffb;
                            margin: 10px;
                            padding: 10px;
                        }
                        .codehead {
                            background-color: #fda;
                            border-radius: 5px;
                            padding: 3px;
                            margin-bottom: 10px;
                        }
                        .codechunk div {
                            line-height: 1.1em;
                        }
                        .textcode {
                            font-family: monospace;
                            background-color: #ffb;
                            border: 1px solid #fda;
                            padding-left: 3px;
                            padding-right: 3px;
                            white-space:nowrap;
                        }
                        hr {
                            color: #ffb;
                            opacity: 0.3;
                        }
                        li p {
                            margin: 0px;
                        }
                     .hll { background-color: #ffffcc }
.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #888888 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.il { color: #666666 } /* Literal.Number.Integer.Long */
                     </style>
                     <title> | Literate Programming Markup |  | A tool for literate programming |  | </title>

<meta name="author" content="Dorian Trupin">
</head><body>
<header>
	<div>Literate Programming Markup</div>
	<div></div>
	<div>A tool for literate programming</div>
	<div></div>
</header>


<div class="authors">By <span>Dorian Trupin</span></div><div class="codetype">Project mainly coded in python</div>


<div class="abstract">
<h1>Abstract</h1>




<p>
LPM (Literate Programming Markup) is a set of two products. First, it is a <a href="https://en.wikipedia.org/wiki/Lightweight_markup_language" target="about:blank">lightweight markup language</a>, suitable for literate programming redaction. It is also a software able to read files written in this language, and to extract code and documentation from it, while reformatting the source file to make it more readable.</p>
<p>
The creation of this program as been motivated by the wish to write literate softwares in a simple and lightweight way, which is not the case with “heavy” markup languages such as LaTeX and HTML. The choice of a new lightweight markup language, instead of using one of the many already existing, is due to the fact that none of these languages enabled us to include source code in the document <span class="bold">in a simple fashion</span>. Literate programming requiring the inclusion of a lot of code in the documentation, it is not pleasant to have, in most of the languages, to indent the code block at each line.</p>
<p>
So, that language is able to detect code block with opening and closing tags, instead of relying on indentation. Our language is also aimed at the redaction of big documentation, which is not the case of a lot of lightweight markup languages (in general thought with small texts in mind, like wiki or blogs articles). Please note that in that field, <a href="https://en.wikipedia.org/wiki/ReStructuredText" target="about:blank">ReStructuredText</a> seems to be tailored for big documentation, but does not meet our requirement for easy code inclusion. The language have also some literate programming specific commands, that we could not have found in a more “general” lightweight markup language.</p>
<p>
The last feature of our software is to offer source code formatting. Indeed, for a first look, we read the generated documentation, but we always work with the original source code. It is pleasant and beneficial to have a well presented source, and that is the goal of our software.</p>

</div><div class="toc"><h1>Table of Content</h1>
<ol>
<li><a href="#sec1The_LPM_markup_language">The LPM markup language</a>
<ol>
<li><a href="#sec1.1Syntax_Basics">Syntax Basics</a>
<ol>
<li><a href="#sec1.1.1Blocks">Blocks</a>
<ol>
</ol>
</li><li><a href="#sec1.1.2Commands">Commands</a>
<ol>
</ol>
</li><li><a href="#sec1.1.3Lightweight_Tags">Lightweight Tags</a>
<ol>
</ol>
</li><li><a href="#sec1.1.4The_Simple_Form__and_the_Complete_Form_of_the_language">The Simple Form, and the Complete Form of the language</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec1.2Document_Structure">Document Structure</a>
<ol>
<li><a href="#sec1.2.1The_Title">The Title</a>
<ol>
</ol>
</li><li><a href="#sec1.2.2The_Abstract">The Abstract</a>
<ol>
</ol>
</li><li><a href="#sec1.2.3The_License">The License</a>
<ol>
</ol>
</li><li><a href="#sec1.2.4The_Author(s)">The Author(s)</a>
<ol>
</ol>
</li><li><a href="#sec1.2.5The_Project_Programming_Language">The Project Programming Language</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec1.3Paragraphs_Format">Paragraphs Format</a>
<ol>
<li><a href="#sec1.3.1Text_Formatting">Text Formatting</a>
<ol>
</ol>
</li><li><a href="#sec1.3.2Links_and_References">Links and References</a>
<ol>
</ol>
</li><li><a href="#sec1.3.3Important_Paragraphs">Important Paragraphs</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec1.4List_Formatting">List Formatting</a>
<ol>
</ol>
</li><li><a href="#sec1.5File_Include_Command">File Include Command</a>
<ol>
</ol>
</li><li><a href="#sec1.6Code_Management">Code Management</a>
<ol>
<li><a href="#sec1.6.1Defining_Code_Block">Defining Code Block</a>
<ol>
</ol>
</li><li><a href="#sec1.6.2Literate_Programming__the_Code_Web">Literate Programming, the Code Web</a>
<ol>
</ol>
</li><li><a href="#sec1.6.3Piece_of_Code_into_the_Paragraphs">Piece of Code into the Paragraphs</a>
<ol>
</ol>
</li><li><a href="#sec1.6.4Code_Summary">Code Summary</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec1.7Character_Escaping">Character Escaping</a>
<ol>
<li><a href="#sec1.7.1In_Paragraph_Character_Escaping">In Paragraph Character Escaping</a>
<ol>
</ol>
</li><li><a href="#sec1.7.2In_Code_Block_Character_Escaping">In Code Block Character Escaping</a>
<ol>
</ol>
</li></ol>
</li></ol>
</li><li><a href="#sec2The_LPM_Command">The LPM Command</a>
<ol>
<li><a href="#sec2.1Command_Usage">Command Usage</a>
<ol>
</ol>
</li><li><a href="#sec2.2D_pendances_du_programme">Dépendances du programme</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec3Impl_mentation">Implémentation</a>
<ol>
<li><a href="#sec3.1Architecture_du_programme">Architecture du programme</a>
<ol>
<li><a href="#sec3.1.1D_but_du_programme_python_et_imports">Début du programme python et imports</a>
<ol>
</ol>
</li><li><a href="#sec3.1.2Les_variables_globales">Les variables globales</a>
<ol>
<li><a href="#sec3.1.2.1Variables_de_configuration">Variables de configuration</a>
<ol>
</ol>
</li><li><a href="#sec3.1.2.2Variables_de_r_f_rence">Variables de référence</a>
<ol>
</ol>
</li><li><a href="#sec3.1.2.3Variables_d_erreur">Variables d'erreur</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec3.1.3La_suite_du_programme">La suite du programme</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec3.2Support_de_l_unicode">Support de l'unicode</a>
<ol>
</ol>
</li><li><a href="#sec3.3Actions_principales_du_programme">Actions principales du programme</a>
<ol>
</ol>
</li><li><a href="#sec3.4Structure_d_un_document">Structure d'un document</a>
<ol>
<li><a href="#sec3.4.1Les_sections">Les sections</a>
<ol>
</ol>
</li><li><a href="#sec3.4.2Les_introductions">Les introductions</a>
<ol>
</ol>
</li><li><a href="#sec3.4.3Les_blocs_de_code">Les blocs de code</a>
<ol>
</ol>
</li><li><a href="#sec3.4.4La_documentation">La documentation</a>
<ol>
</ol>
</li><li><a href="#sec3.4.5Les_paragraphes">Les paragraphes</a>
<ol>
</ol>
</li><li><a href="#sec3.4.6Pour_r_sumer">Pour résumer</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec3.5Gestion_des_documents">Gestion des documents</a>
<ol>
<li><a href="#sec3.5.1La_classe_Document">La classe Document</a>
<ol>
<li><a href="#sec3.5.1.1Formater_le_fichier_source">Formater le fichier source</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.2Charger_le_fichier">Charger le fichier</a>
<ol>
<li><a href="#sec3.5.1.2.1Ignorer_les_blocs_de_code">Ignorer les blocs de code</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.2.2G_rer_les_~Get">Gérer les ~Get</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.2.3G_rer_les_~Include_et_~Image">Gérer les ~Include et ~Image</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.2.4G_rer_les_~Copy">Gérer les ~Copy</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.2.5G_rer_les_autres_cas">Gérer les autres cas</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.2.6Analyser_les_fichiers_inclus">Analyser les fichiers inclus</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.2.7La_fonction_begin()">La fonction begin()</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec3.5.1.3R_capitulatif_de_la_cr_ation_d_un_document">Récapitulatif de la création d'un document</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.4Extraire_les_informations_sp_cifiques_au_document">Extraire les informations spécifiques au document</a>
<ol>
<li><a href="#sec3.5.1.4.1D_tecter_les_titres">Détecter les titres</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.4.2D_tecter_le_r_sum__et_la_licence">Détecter le résumé et la licence</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.4.3D_tecter_les_auteurs">Détecter les auteurs</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.4.4D_tecter_le_langage_du_document">Détecter le langage du document</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.4.5Retenir_les_autres_lignes">Retenir les autres lignes</a>
<ol>
</ol>
</li><li><a href="#sec3.5.1.4.6R_sum_">Résumé</a>
<ol>
</ol>
</li></ol>
</li></ol>
</li><li><a href="#sec3.5.2La_classe_Section">La classe Section</a>
<ol>
</ol>
</li><li><a href="#sec3.5.3La_classe_Introduction">La classe Introduction</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec3.6Gestion_des_blocs_de_code">Gestion des blocs de code</a>
<ol>
</ol>
</li><li><a href="#sec3.7Gestion_de_la_documentation">Gestion de la documentation</a>
<ol>
</ol>
</li><li><a href="#sec3.8Afficher_la_structure_du_document">Afficher la structure du document</a>
<ol>
</ol>
</li><li><a href="#sec3.9Formater_les_documents_source">Formater les documents source</a>
<ol>
</ol>
</li><li><a href="#sec3.10Sortie_HTML_du_document">Sortie HTML du document</a>
<ol>
</ol>
</li><li><a href="#sec3.11Code_final">Code final</a>
<ol>
</ol>
</li></ol>
</li><li><a href="#sec4Un_fichier_pour_tester_le_programme">Un fichier pour tester le programme</a>
<ol>
</ol>
</li></ol>
</div>

<h1><a id="sec1The_LPM_markup_language">1. The LPM markup language</a></h1>



<p>
<a href="#Syntax_Basics"></a></p>



<h2><a id="sec1.1Syntax_Basics">1.1. Syntax Basics</a></h2>



<p>
There are many types of tags in the LPM language. Lightweight tags, meant to format the text, commands, that will execute actions at document generation, and block tags, enabling us to define text blocks.</p>



<h3><a id="sec1.1.1Blocks">1.1.1. Blocks</a></h3>



<p>
The most basic mean to define a block is to left a blank line beetween to text blocks:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>Here is a text block.

And a second text block,
spanning two lines.

And a third text block.
</pre></div>
</div>
<p>
We call those text blocks “paragraphs”. When the file will be formatted, the blocks lines will be merged if the result is not too long.<a href="#ref1" id="toref1"><sup>1</sup></a> Thus, the example above will become, after formatting:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>Here is a text block.

And a second text block, spanning two lines.

And a third text block.
</pre></div>
</div>
<p>
The second block is now one single line. In contrast, if a line is too long, a line feed will be added.</p>
<p>
There are other means to define blocs. When we create a list, or when we insert a code block, we create blocks, and their behavior is different from the paragraphs one.</p>





<h3><a id="sec1.1.2Commands">1.1.2. Commands</a></h3>



<p>
Commands fit on one line. They force the end of a paragraph, even if there is no blank line beetween them and said paragraph. They usually begin with the character <span class="textcode">~</span><a href="#ref2" id="toref2"><sup>2</sup></a>. A command can enable us to define a document data (source code language, authors…), or to include other files at this point of the text. Here is an example of commands:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>~code python

This is a pararaph
~include test.txt
</pre></div>
</div>
<p>
In that example, the paragraph doesn't merge with the following command, even if the line is not too long. That is: <span class="bold">a command stay a command, alone on a line</span>.</p>





<h3><a id="sec1.1.3Lightweight_Tags">1.1.3. Lightweight Tags</a></h3>



<p>
Lightweight tags are tags found inside lines. There can be many on one line. Lightweight tags act inside a paragraph. The can put text in bold, italic, define links… And all of that without deteriorating the text with a characters overflow. Here is an example:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>This is a **bold text** followed by a reference to a footnote.*
</pre></div>
</div>





<h3><a id="sec1.1.4The_Simple_Form__and_the_Complete_Form_of_the_language">1.1.4. The Simple Form, and the Complete Form of the language</a></h3>



<p>
The markup language's goal is to make the source documents easy to read. To this end, characters are used to “draw” text decorations. That way is aesthetic, but not nice to write on our own. So, for some markup, there is an abbreviated form, said “simple”, that will be transformed into the “complete” form by our program, more pretty. As an example, we write the book title like that (simple form):</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>**
* A title
**
</pre></div>
</div>
<p>
Or, on a more heavy fashion:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>***********
* A title *
***********
</pre></div>
</div>
<p>
And the software will center the title, thus giving us:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>                             ***********
                             * A title *
                             ***********
</pre></div>
</div>
<p>
Those three means of writing a title are absolutely equivalent for our tool, and are only there to make our life easier.</p>







<h2><a id="sec1.2Document_Structure">1.2. Document Structure</a></h2>



<p>
A document as a title, one or many authors, a license, and an abstract. In addition to that, it is composed of many sections, that structure the document.</p>



<h3><a id="sec1.2.1The_Title">1.2.1. The Title</a></h3>



<p>
The title is the title of the document (tautology?). It has to be at the beginning of the said document. It is written in a star frame. If it is several lines long, the frame is as wide as the widest line, and other lines are centered.</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>               *****************************************
               *            Document Title             *
               *                                       *
               * This is a test document, with a title *
               *                                       *
               *****************************************
</pre></div>
</div>
<p>
It is possible to simplify the title, at redaction time, by marking it as follow:</p>
<ul><li><p>
A line containing at least two stars, and nothing else (except maybe some spaces before and after the line), will mark the beginning of the title.</p>
</li><li><p>
After that, all lines begin with a star, then the text. The last star of the line is ignored (as it is considered to be part of the frame). If you want a line ending with a star (in addition to the one of the frame), you will have to put two stars.</p>
</li><li><p>
After all these lines, a new line containing two stars or more, and nothing else, mark the end of the title.</p>
</li></ul>
<p>
So, a simplified title looks like that:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>**
* Document Title
*
* This is a test document, with a title
*
**
</pre></div>
</div>





<h3><a id="sec1.2.2The_Abstract">1.2.2. The Abstract</a></h3>



<p>
We begin the abstract with the command <span class="textcode">~abstract~</span>. We then write a bunch of paragraphs, then close the abstract with the command <span class="textcode">~~~</span>.</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>~abstract~
This is an abstract of our document.

With **two** paragraphs!
~~~
</pre></div>
</div>
<p>
Once formatted, the command <span class="textcode">~Abstract~</span> is centered, it's first letter capitalized. The <span class="textcode">~~~</span> that close the abstract is centered too. The paragraphs of the abstract are shorter, and indented, like here:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>                               ~Abstract~

    This is an abstract of our document.

    With **two** paragraphs!

                                  ~~~
</pre></div>
</div>





<h3><a id="sec1.2.3The_License">1.2.3. The License</a></h3>



<p>
The license format is modeled after the abstract one, but using the <span class="textcode">~License~</span> instead of the <span class="textcode">~Abstract~</span> one.</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>                               ~License~

    __**LRL Recursive License**__

    //Copyright Tartempion © 1842//

    Permission is granted  to  use,  copy, modify and/or distribute
    this work as long as:

     # You follow the license

    This license is under LRL Recursive license.

                                  ~~~
</pre></div>
</div>





<h3><a id="sec1.2.4The_Author(s)">1.2.4. The Author(s)</a></h3>



<p>
We can specify the authors of the document thank to the <span class="textcode">~authors</span> command. That command can appear many times, and authors will be grouped and displayed under the title. If the command appear many times, after formatting, it will again appear many times. We think that if it as been typed more than once, there is a reason and we should not merge the commands.</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>~authors Ludovic Broutille and Mélanine de Balzac.
</pre></div>
</div>





<h3><a id="sec1.2.5The_Project_Programming_Language">1.2.5. The Project Programming Language</a></h3>



<p>
Code blocks will be inserted throughout the document. Those can be prettified with syntax highlighting, but only if we know the programming language. We can define that language at each code block, but to save us from typing it each time, we can also specify the more used language in the document. We use the command <span class="textcode">~code</span> to that effect.</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>~code haskell
</pre></div>
</div>







<h2><a id="sec1.3Paragraphs_Format">1.3. Paragraphs Format</a></h2>



<p>
As said in the part <a href="#Syntax_Basics"><span class="underline">Syntax Basics</span></a>, a paragraph is defined by a sequence of non blank lines. A paragraph begins at the first non blank line encountered, and stop as soon as it encounters:</p>
<ul><li><p>
lines formatted as lists,</p>
</li><li><p>
lines containing commands like <span class="textcode">~include</span> (beginning with <span class="textcode">~</span>),</p>
</li><li><p>
lines that mark the beginning of a code block,</p>
</li><li><p>
lines that mark a URL or a footnote,</p>
</li><li><p>
lines that mark the beginning of an important paragraph,</p>
</li><li><p>
lines that mark the beginning of a section (starting with <span class="textcode">=</span>),</p>
</li><li><p>
blank lines.</p>
</li></ul>



<h3><a id="sec1.3.1Text_Formatting">1.3.1. Text Formatting</a></h3>



<p>
Inside a paragraph, it is possible to use characters that will put our text in <span class="bold">bold</span>, <span class="italic">italic</span>, <span class="underline">underlined</span>, and <span class="overline">striked</span>.</p>
<p>
Consequently, the paragraph above looks like that:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>Inside a paragraph, it is possible  to  use characters that will put our
text in **bold**, //italic//, __underlined__, and --striked--. 
</pre></div>
</div>





<h3><a id="sec1.3.2Links_and_References">1.3.2. Links and References</a></h3>



<p>
You can also add links to your document. A link is denoted by square parentheses, and apply to it's preceding word, or a group of word if it is in parentheses (in that case, parentheses will not appear in the generated document). A link containing a word is an intra-document link. Link to the outside world (internet) are denoted by two dots, and defined at the end of the paragraph with the command <span class="textcode">..:</span>. Links beginning with <span class="textcode">=</span> are not links, but anchors to which we can point. Thus, we have:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>An (outside link)[..], a link to an anchor[an anchor].
..:http://example.org/

Some text.

The anchor[=an anchor] in question.
</pre></div>
</div>
<p>
Like the outside links, we can create footnotes. To this end, we place a star (and only one, two stars are to put text in bold) right after the word that we want to comment on. The <span class="textcode">*:</span> command will mark said comment, and be followed on the same line and the next ones by a paragraph which will be the footnote.</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>My text with* a footnote.
*: //with// is not //whit//.
</pre></div>
</div>
<div class="warning"><p>
To know what footnote or URL a reference point to, the software assign to each footnote or URL a number (counting them), and a number to each reference. References to an URL will point to the URL with the same number, and it works the same for footnotes. If you forget a footnote, there will be a shift in the references!</p>
<p>
It is a good idea to keep your footnotes and URLs just after the paragraph that references them, but you are not forced to do so. A note can even precede it's reference, as long as the count (the order in which the footnotes appear) is not changed. It would be unadvised to do so, however…</p>
</div>




<h3><a id="sec1.3.3Important_Paragraphs">1.3.3. Important Paragraphs</a></h3>



<p>
It can be useful to emphasize an entire paragraph, like the last one in the previous section. To that effect, we use the command <span class="textcode">/!\</span>. That command will take the following paragraph and mark it as important. It is possible to put two paragraph in a same important block, by placing that command on the blank line that split our two paragraphs. Finally, that block (yes, we are marking a <span class="bold">text block</span> as important) has a complete form: each line of the block begins and ends with that command. Like for the abstracts and license blocks, the important block will be shorter and indented. So, that code:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>/!\An important
paragraph
/!\
/!\And another important paragraph

/!\The two paragraphs above are in 
one block, and this one in another.
</pre></div>
</div>
<p>
Will become:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>    /!\ An important paragraph                                   /!\
    /!\                                                          /!\
    /!\ And another important paragraph                          /!\

    /!\ The two paragraphs  above  are  in  one  block, and this /!\
    /!\ one in another.                                          /!\
</pre></div>
</div>







<h2><a id="sec1.4List_Formatting">1.4. List Formatting</a></h2>



<p>
It is possible to create both numbered and non-numbered lists with LPM. Numbered lists are entered as a sequence on lines beginning with <span class="textcode">#</span>, each <span class="textcode">#</span> being the beginning of an element of the list. Non-numbered lists are denoted by a <span class="textcode">-</span>, each <span class="textcode">-</span> being the beginning of an element of the list.</p>
<p>
If an element of the list take more than one line, it is possible to continue on the next line, without beginning a new list element, by starting the line with <span class="textcode">&#39;</span> rather than with <span class="textcode">-</span>. In fact, a line beginning by <span class="textcode">#</span> or <span class="textcode">-</span> and followed by lines beginning with <span class="textcode">&#39;</span> becomes, when that first column is removed, a sequence of text blocks, that can be lists (and so, nested lists), paragraphs…</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre> - A non numbered list
 - A second element

 # A numbered list
 &#39; whose first element is on many lines
 # The second element embed a non-numbered list
 &#39; - First element of a nested list
 &#39; - Second element of a nested list
 &#39; &#39; on many lines
 # Third element has many paragraphs
 &#39;
 &#39; This is the second paragraph of the third element.
</pre></div>
</div>





<h2><a id="sec1.5File_Include_Command">1.5. File Include Command</a></h2>



<p>
Some commands can insert other files in the document. Those take as a parameter the path and name of the file to include, relative to the position of the file in which the command appears.</p>
<p>
Let's take for example, to illustrate that idea, the following file tree:</p>
<ul><li><p>
document.txt</p>
</li><li><p>
includes</p>
<ul><li><p>
duck.txt</p>
</li><li><p>
coco.txt</p>
</li></ul>
</li></ul>
<p>
If the file <span class="italic">document.txt</span> wants to include <span class="italic">duck.txt</span>, it will use the command <span class="textcode">~get includes/duck.txt</span>. Now, if <span class="italic">duck.txt</span> wants to include <span class="italic">coco.txt</span>, it will use the command <span class="textcode">~get coco.txt</span>, and not <span class="textcode">~get includes/coco.txt</span>. What we are interested in is the position of the current file, not the position from where the command <span class="textcode">lpm</span> has been issued.</p>
<p>
We can insert an image in the documentation with the <span class="textcode">~image</span> command:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>~image img/lolcat.jpg
</pre></div>
</div>
<p>
We can also insert a raw text file in the documentation with the <span class="textcode">~include</span> command:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>~include rfc/rfc1149.txt
</pre></div>
</div>
<p>
Finally, we can include a LPM file, which will be read and formatted before being added to the documentation:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>~get part-2.lpm
</pre></div>
</div>
<p>
That last command is very important, because it enable us to split our documentation in many smaller files, easier to edit in a text editor. It also enable us, if we have a file per section, to create a “table of content” in the main file, and to reorganize the documentation just by changing the order of the inclusions.</p>
<p>
At last, we'd like to talk about a command that doesn't, in reality, include a file in the documentation, but in the generated source code. The command <span class="textcode">~copy</span>.</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>~copy image.jpg data/image.jpg
</pre></div>
</div>
<p>
That command takes two files as parameters. It will copy the file in the first parameter (and whose position is relative to the current file), into the file in the second parameter, whose position will be relative to the folder in which will be placed the source code. Spaces and other problematic characters should be escaped with <span class="textcode">\</span>.</p>





<h2><a id="sec1.6Code_Management">1.6. Code Management</a></h2>




<h3><a id="sec1.6.1Defining_Code_Block">1.6.1. Defining Code Block</a></h3>



<p>
An important functionnality of the LPM language is the management of the source code. It is possible to easily include source code in the document:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>&lt;code:
import os
print os.getcwd()
&gt;
</pre></div>
</div>
<p>
Which will output:</p>
<div class="codechunk"><div class="codehead">Code :  </div>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</pre></div>
</div>
<p>
Additionally, it is possible to specify the programming language used in the code block, which enable us to:</p>
<ol><li><p>
specify, for the reader, the language that he is currently reading,</p>
</li><li><p>
apply syntax highlighting to code blocks.</p>
</li></ol>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>&lt;code (haskell):
fibs = 0 : 1 : (zipWith (+) fibs (tail fibs))
fib n = fibs !! n
&gt;
</pre></div>
</div>
<p>
Will become :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(haskell)</span>:  </div>
<div class="highlight"><pre><span class="nf">fibs</span> <span class="ow">=</span> <span class="mi">0</span> <span class="kt">:</span> <span class="mi">1</span> <span class="kt">:</span> <span class="p">(</span><span class="n">zipWith</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span> <span class="n">fibs</span> <span class="p">(</span><span class="n">tail</span> <span class="n">fibs</span><span class="p">))</span>
<span class="nf">fib</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">fibs</span> <span class="o">!!</span> <span class="n">n</span>
</pre></div>
</div>
<p>
It is also possible to name a code block:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>&lt;code (c): test.c
#include &lt;stdio.c&gt;
void main(){
	printf(&quot;Hello, world!\n&quot;);
}
&gt;
</pre></div>
</div>
<p>
And, finally, it is possible to reference a named code block:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>&lt;code (c): test.c
#include &lt;stdio.c&gt;
void main(){
	&lt;main&#39;s implementation
}
&gt;
</pre></div>
</div>





<h3><a id="sec1.6.2Literate_Programming__the_Code_Web">1.6.2. Literate Programming, the Code Web</a></h3>



<p>
That last functionality bring us to the core idea of literate programming: we write small pieces of code, in which we include references to other pieces of code. It is possible to begin a code block, then append later more code to that piece, by creating an other code block with the same name. That way of presenting code, weaved with references, is not to far of the idea of the World Wide Web and it's hyperlinks, and, even if literate programming predate the World Wide Web, it's author already had perceived that idea of a web created by the references, and named his invention “web”.</p>
<p>
So, with the following code block collection:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>&lt;code (c): test.c
#include &lt;stdio.c&gt;
&gt;
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>&lt;code (c): test.c
void main(){
	&lt;main&#39;s implementation
}
&gt;
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>&lt;code (c): main&#39;s implementation
printf(&quot;Hello, world!&quot;);
&gt;
</pre></div>
</div>
<p>
The code chunk <span class="italic">test.c</span> will be reunified, then the reference to <span class="italic">main's implementation </span> will be resolved and replaced by the code so named. All code lines will be indented with has many characters as the ones preceding the command referencing the block. That feature is necessary to, first, have a readable source code output, and second, support some languages in which indentation is meaningful (a python literate program would be impossible without this feature, as well as a literate Makefile).</p>
<p>
To output the source code, the software will look for code block names. Those never referenced will be considered as output, and be placed in files with the name of the code block.</p>
<p>
In the example before, <span class="italic">test.c</span> is never included into an other code block, so a file will be created with this name. However, <span class="italic">main's implementation</span> is inserted into an other block, and it will not be output into it's own file.<a href="#ref3" id="toref3"><sup>3</sup></a></p>





<h3><a id="sec1.6.3Piece_of_Code_into_the_Paragraphs">1.6.3. Piece of Code into the Paragraphs</a></h3>



<p>
It is possible to mark a portion of paragraph text as source code. That allow us to apply special formatting and syntax highlighting to the code. We mark a portion of text as code by surrounding it with angle brackets: <span class="textcode">&lt;import os&gt;</span>. It is possible to specify the language of the source code by adding, right after the openning angle bracket, the language name, itself surrounded by the same brackets: <span class="textcode">&lt;&lt;C&gt;printf(&quot;Wouhou!&quot;)&gt;</span>.</p>





<h3><a id="sec1.6.4Code_Summary">1.6.4. Code Summary</a></h3>



<p>
It can be useful to present the summary of a code chunk when it has been wrote piece by piece. Two commands allow us to display the generated code:</p>
<p>
The first one allow us to recall a code chunk as it has been wrote, but in one piece, even if it was splitted in multiple blocks:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>~remain code chunk
</pre></div>
</div>
<p>
The second one allow us to display the code chunk entirely, without any reference. That is, the code as it would be output into a file if the chunk name was not referenced anywhere:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>~display code chunk
</pre></div>
</div>







<h2><a id="sec1.7Character_Escaping">1.7. Character Escaping</a></h2>




<h3><a id="sec1.7.1In_Paragraph_Character_Escaping">1.7.1. In Paragraph Character Escaping</a></h3>



<p>
When we use characters that should be interpreted by LPM, but want them “as is” in the output, we have to escape them. That is done the Unix way: every character preceded by <span class="textcode">\</span> will be rendered “as is”, without being interpreted. For instance, <span class="textcode">\**</span> will display <span class="textcode">**</span>. For a more complex instance, let's look at the following code display: <span class="textcode">&lt;&lt;C&gt;printf(&quot;Wouhou!&quot;)&gt;</span>.<a href="#ref4" id="toref4"><sup>4</sup></a> To manage to print it, we had to escape every special character in that piece of code, especially the <span class="textcode">&gt;</span> which would have closed the code quotation if it wheren't for the <span class="textcode">\</span>. Hence, that code looked like this: <span class="textcode">&lt;&lt;lpm&gt;\&lt;\&lt;C\&gt;printf(&quot;Wouhou!&quot;)\&gt;&gt;</span>.</p>





<h3><a id="sec1.7.2In_Code_Block_Character_Escaping">1.7.2. In Code Block Character Escaping</a></h3>



<p>
If a code line begins with <span class="textcode">&lt;</span>, it will be interpreted as a reference to another code block. If it begins with <span class="textcode">&gt;</span>, it will be interpreted as the end of the code block. To prevent this, we can escape the line, by beginning it with the <span class="textcode">\</span> character. Unlike the “traditional” escapement method, that character, in code blocks, will escape the entire line, that can then be composed of anything, and not just one character.</p>
<p>
So:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>&lt;code:
import os
\&lt;coco
&gt;
</pre></div>
</div>
<p>
Will give:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>import os
&lt;coco
</pre></div>
</div>
<p>
And to display that code block, we had to escape the line beginning with <span class="textcode">\</span>, <span class="italic">not by escaping the <span class="textcode">\</span> character, but the entire line</span>. The used code was that one:</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>:  </div>
<div class="highlight"><pre>&lt;code (lpm):
\&lt;code:
import os
\\&lt;coco
\&gt;
&gt;
</pre></div>
</div>
<p>
<span class="italic">We see here that we only escaped the <span class="textcode">\</span>, and not the <span class="textcode">\&lt;</span>, which should have been escaped <span class="textcode">\\\&lt;</span> (instead of <span class="textcode">\\&lt;</span>) if we had escaped character by character instead of line by line.</span></p>









<h1><a id="sec2The_LPM_Command">2. The LPM Command</a></h1>




<h2><a id="sec2.1Command_Usage">2.1. Command Usage</a></h2>



<p>
The software is easy to use: we launch the <span class="textcode">lpm</span> command, followed by the name of our documentation. We only give one file to the command, if the document is splitted in many files, the software will fetch them automatically.</p>
<p>
The command does three things:</p>
<ul><li><p>
It creates an HTML file with nicely formatted documentation. It's name is the same as the one given as argument to the command, with the <span class="italic">.html</span> file extension appended. That file is created in the current directory (where LPM as been called).</p>
</li><li><p>
It creates a directory <span class="italic">src</span> containing all the source files extracted from the documentation. Subfolders are created if required. That directory also is in the current directory.</p>
</li><li><p>
Finally, it creates, for each documentation file, a <span class="italic">.clean</span> file, with equivalent content, but nicelly formatted (justified text, important blocks indented, centered title, 72 columns lines...). Ideally, that <span class="italic">.clean</span> should replace the original file. For now, it is advised to check the <span class="italic">.clean</span> content, as there can be lost content if your file had syntax errors. Also, note that if your file is already formatted, that is, there is no difference beetween your file and the output <span class="italic">.clean</span>, no <span class="italic">.clean</span> is created.</p>
</li></ul>
<p>
With a graphical environment where drag and drop is implemented<a href="#ref5" id="toref5"><sup>5</sup></a>, you can, if you want, not use the command line, and just drop the documentation file on the software icon. As it only need one argument, the name of the file to extract, everything should go according to plan.</p>
<p>
It is possible to tell to the software to only perform some actions. Base actions are “surprising”: <span class="italic">WTF</span>. “<span class="bold">W</span>” stands for “<span class="bold">Weave</span>”. Weaving is the action to create the HTML documentation file from our source file. “<span class="bold">T</span>” stands for “<span class="bold">Tangle</span>”. That action take our straightforward source code, organized in a way that please our brain, and entangle it, making it less pleasant for human reading, but understandable by the computer. Finally, “<span class="bold">F</span>” stands for “<span class="bold">Format</span>”, which is the action of creating a <span class="italic">.clean</span> file for each documentation source file, containing a nicely formatted source.</p>
<p>
Three more actions are possible: “<span class="bold">A</span>” will “<span class="bold">Apply</span>” the formatted sources: it will replace original source documentation by formatted source documentation. Use that command only if you are sure that your file as been correctly parsed<a href="#ref6" id="toref6"><sup>6</sup></a>, and that no content is lost in the <span class="italic">.clean</span>. “<span class="bold">C</span>” will “<span class="bold">Clean</span>” your current directory, that is, remove <span class="bold">all</span> of the files generated by the LPM command. LPM knows what files to remove because it always use the same name and path conventions. It remove files blindly: do not modify a file generated by LPM, modifications will be lost! Finally, “<span class="bold">M</span>” will “<span class="bold">Monitor</span>” your source code: each time you modify a file and save it, it will extract again the source code and documentation (and apply the <span class="italic">.clean</span>s if you asked for it).</p>
<p>
There are two means of telling to the software to change is behavior: the Unix way, and the “graphical” way. The Unix way is just to append parameters on the command line. The “graphical” way is meant to support graphical environment, where we cannot always pass parameters to the command. In that case, the software analyse it's own name, and extract from it what it should do. So, creating a link to the executable file can change it's behavior. To each option is associated a word. If that word appear in the command name, it will be as if the option had been passed. As said before, the default behavior is “surprising”: <span class="textcode">-wtf</span>. The options <span class="textcode">-a</span> and <span class="textcode">-c</span> are not used by default. Here is a list of the options:</p>
<ul><li><p>
<span class="textcode">-w</span>, <span class="italic">weave</span> : create an HTML representation of the documentation.</p>
</li><li><p>
<span class="textcode">-t</span>, <span class="italic">tangle</span> : extract the computer source code.</p>
</li><li><p>
<span class="textcode">-f</span>, <span class="italic">format</span> : format the documentation source files, and create <span class="italic">.clean</span> files containing that formatted output.</p>
</li><li><p>
<span class="textcode">-a</span>, <span class="italic">apply</span> : replace documentation source files by their associated <span class="italic">.clean</span> (<span class="italic">apply</span> the formatting)</p>
</li><li><p>
<span class="textcode">-c</span>, <span class="italic">clean</span> : remove all files generated by LPM.</p>
</li></ul>
<p>
<span class="italic">If we create a link to LPM named </span>tangle<span class="italic">, only the </span>tangle<span class="italic"> operation will be performed when using this link. We can obtain the same effect by creating a link </span>lpm_tangle<span class="italic">, if we want to avoid conflicts with other commands, like the ones from </span>WEB<span class="italic"> from Donald Knuth. What matters is that the file name <span class="bold">contain</span> the action word. We also can create two actions commands, like, for instance, </span>format-apply<span class="italic"> (at your own risks), or </span>weave-tangle<span class="italic">.</span></p>
<div class="warning"><p>
The word apparition order (and the options apparition order) is meaningful. So, calling LPM with <span class="textcode">-ct</span> options will clean the sources and extract them again, whereas the <span class="textcode">-tc</span> options will extract the source and remove them right away (which is like doing nothing, but slower). The same effect/non-effect will be obtained with a LPM command named <span class="italic">clean-tangle</span> and another one called <span class="italic">tangle-clean</span>.</p>
</div>




<h2><a id="sec2.2D_pendances_du_programme">2.2. Dépendances du programme</a></h2>



<p>
Le programme est écrit en python, et nécessite donc un interpréteur python. Il n'est pas écrit en python3, et nous ne savons pas s'il est compatible avec celui-ci. (À vrai dire, il y a peu de chances…)</p>
<p>
Le programme utilise aussi pour la coloration syntaxique le module <a href="http://pygments.org/" target="about:blank">pygments</a>, qui est donc nécessaire pour la sortie HTML. Ce sont théoriquement les seules dépendances du programme.</p>







<h1><a id="sec3Impl_mentation">3. Implémentation</a></h1>




<h2><a id="sec3.1Architecture_du_programme">3.1. Architecture du programme</a></h2>



<p>
Le programme est constitué d'un seul script python. Celui-ci contient toutes les données nécessaires au fonctionnement du programme.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="lpm1">lpm</a></span> <a href="#coderef65">(65)</a> </div>
<div><pre><a id="coderef1" href="#d_but_d_un_programme_python1">début d'un programme python</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef2" href="#imports1">imports</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef3" href="#variables_globales1">variables globales</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef4" href="#fonctions_utilitaires1">fonctions utilitaires</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef5" href="#d_finition_des_classes1">définition des classes</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef6" href="#actions_principales1">actions principales</a></pre></div>
<div class="highlight"><pre>
</pre></div>
</div>
<p>
Lors de la définition des classes, nous les découperons en trois catégories : les classes de gestion du document, les classes de gestion des blocs de code, et les classes de gestion des blocs de documentation :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="d_finition_des_classes1">définition des classes</a></span> <a href="#coderef5">(5)</a> </div>
<div><pre><a id="coderef7" href="#gestion_des_blocs_de_code1">gestion des blocs de code</a></pre></div>
<div><pre><a id="coderef8" href="#gestion_des_blocs_de_documentation1">gestion des blocs de documentation</a></pre></div>
<div><pre><a id="coderef9" href="#gestion_des_documents1">gestion des documents</a></pre></div>
</div>
<p>
<span class="italic">Les classes de gestion des documents sont placées à la fin car elles font appel aux classes de gestion du code et de la documentation.</span></p>



<h3><a id="sec3.1.1D_but_du_programme_python_et_imports">3.1.1. Début du programme python et imports</a></h3>



<p>
Il débute bien entendu en spécifiant quel interpréteur utiliser, et quels modules seront utilisés. Nous ne notons pas tout de suite quels modules nous allons utiliser, mais les modules suivants au moins semblent « logiques », car utilisés très souvent :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="d_but_d_un_programme_python1">début d'un programme python</a></span><a href="#d_but_d_un_programme_python2"> -&gt;</a> <a href="#coderef1">(1)</a> </div>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python2</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="imports1">imports</a></span><a href="#imports2"> -&gt;</a> <a href="#coderef2">(2)</a> </div>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
</pre></div>
</div>
<p>
Nous importons <span class="textcode"><span class="n">path</span></span> directement plutôt que de se réferer toujours à <span class="textcode"><span class="n">os</span><span class="o">.</span><span class="n">path</span></span>, car nous allons beaucoup utiliser ce module.</p>





<h3><a id="sec3.1.2Les_variables_globales">3.1.2. Les variables globales</a></h3>



<p>
Les variables globales sont de deux genre : les variables « template », contenant les feuilles de style, le code HTML réutilisé… Et les variables « système », utilisées dans le programme pour stocker des informations qui doivent être accessibles de n'importe où.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="variables_globales1">variables globales</a></span> <a href="#coderef3">(3)</a> </div>
<div><pre><a id="coderef10" href="#variables_syst_me1">variables système</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef11" href="#variables_template1">variables template</a></pre></div>
</div>
<p>
Parmis les variables système, on peut encore distinguer trois type de variables : les variables de configuration, certaines étant constantes et pouvant être modifiée dans le code source pour adapter le comportement du programme à ses besoins, d'autres étant modifiées par des commandes dans le document passé en paramètre, les variables de stockage, qui sont utilisées pour stocker les morceaux de code et les références, et les variables d'erreur, qui contiennent les informations relatives aux erreurs non fatales rencontrées par le programme, et qui sans passer par ces variables, seraient affichées en double (ce qui serait inutile et rendrait la sortie d'erreur plus difficile à lire).</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="variables_syst_me1">variables système</a></span> <a href="#coderef15">(15)</a> <a href="#coderef10">(10)</a> </div>
<div><pre><a id="coderef12" href="#variables_de_configuration1">variables de configuration</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef13" href="#variables_de_r_f_rence1">variables de référence</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef14" href="#variables_d_erreur1">variables d'erreur</a></pre></div>
</div>



<h4><a id="sec3.1.2.1Variables_de_configuration">3.1.2.1. Variables de configuration</a></h4>



<p>
Les variables de configuration contiennent la taille du texte par défaut (en caractères), la taille des marges, une chaîne de caractère représentant cette marge quand on doit la placer à gauche (bref, quand on indente un paragraphe), et le langage de programmation majeur du document.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="variables_de_configuration1">variables de configuration</a></span> <a href="#coderef12">(12)</a> </div>
<div class="highlight"><pre><span class="n">DOCUMENT_WIDTH</span> <span class="o">=</span> <span class="mi">72</span>
<span class="n">INDENTATION</span> <span class="o">=</span> <span class="s">&quot;    &quot;</span>
<span class="n">MARGINS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">INDENTATION</span><span class="p">)</span>
<span class="n">DOCUMENT_LANGUAGE</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
</pre></div>
</div>
<p>
Parmis ces variables, seule <span class="textcode"><span class="n">DOCUMENT_LANGUAGE</span></span> peut être modifiée dans le document, grâce à la commande <span class="textcode">~code</span>.</p>





<h4><a id="sec3.1.2.2Variables_de_r_f_rence">3.1.2.2. Variables de référence</a></h4>



<p>
Il existe trois types de référence dans le programme :</p>
<ul><li><p>
les notes de bas de page,</p>
</li><li><p>
les URLs</p>
</li><li><p>
les morceaux de codes.</p>
</li></ul>
<p>
Chaque référence de chaque type est identifiée par un numéro. Nous avons une variable pour chaque type de référence nous permettant de compter ces référence et de leur assigner un numéro correct.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="variables_de_r_f_rence1">variables de référence</a></span><a href="#variables_de_r_f_rence2"> -&gt;</a> <a href="#coderef13">(13)</a> </div>
<div class="highlight"><pre><span class="n">NOTEREFS</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">URLREFS</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">CODEREFS</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>
Dans le cas des URLs et des notes de bas de page, elles sont retenues dans un tableau. Une note ou une URL pointera vers la note/URL contenue dans le tableau à l'index correspondant au numéro de la référence.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="variables_de_r_f_rence2">variables de référence</a></span><a href="#variables_de_r_f_rence1"> &lt;-</a><a href="#variables_de_r_f_rence3"> -&gt;</a> <a href="#coderef13">(13)</a> </div>
<div class="highlight"><pre><span class="n">FOOTNOTES</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">FOOTURLS</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>
Dans le cas des morceaux de code, nous utilisons un dictionnaire, permettant de se référer au morceau de code par son nom. Le numéro associé à chaque référence permet de faire des liens vers les références elles mêmes à côté d'un bloc de code, afin d'annoncer « dans quel bloc de code celui-ci est-il utilisé ? ».</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="variables_de_r_f_rence3">variables de référence</a></span><a href="#variables_de_r_f_rence2"> &lt;-</a><a href="#variables_de_r_f_rence4"> -&gt;</a> <a href="#coderef13">(13)</a> </div>
<div class="highlight"><pre><span class="n">CODE</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>
Enfin, nous parserons les fichiers deux fois : une fois pour générer un fichier mieux formaté, et une fois pour générer la documentation. Lors du parsing, nous commençons déjà à retenir quels objets contiennent des références. Si nous le faisons pour les deux parsings successifs, nous compterons chaque référence deux fois. Afin d'éviter cela, nous utilisons une variable globale, <span class="textcode"><span class="n">RESOLVE_REFERENCES</span></span>, positionnée à <span class="textcode"><span class="bp">False</span></span> au départ, et que nous passerons à <span class="textcode"><span class="bp">True</span></span> lorsque nous serons prêts à compter les références pour de bon.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="variables_de_r_f_rence4">variables de référence</a></span><a href="#variables_de_r_f_rence3"> &lt;-</a> <a href="#coderef13">(13)</a> </div>
<div class="highlight"><pre><span class="n">RESOLVE_REFERENCES</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>





<h4><a id="sec3.1.2.3Variables_d_erreur">3.1.2.3. Variables d'erreur</a></h4>



<p>
Les variables d'erreur contiennent des erreurs qui peuvent se répeter, mais que nous ne voulons signaler qu'une fois. Ces erreurs concernent par exemple les morceaux de code référencés non-existants, ou les langages utilisés qui ne peuvent pas être colorisés syntaxiquement.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="variables_d_erreur1">variables d'erreur</a></span> <a href="#coderef14">(14)</a> </div>
<div class="highlight"><pre><span class="n">COLOR_ERRORS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">CODEREF_ERRORS</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>
À ce point, voici un récapitulatif des variables globales utilisées par le programme :</p>
<div class="codechunk"><div class="codehead">Output of code <a href="#variables_syst_me1" id="coderef15">variables système</a>:</div><div class="highlight"><pre><span class="n">DOCUMENT_WIDTH</span> <span class="o">=</span> <span class="mi">72</span>
<span class="n">INDENTATION</span> <span class="o">=</span> <span class="s">&quot;    &quot;</span>
<span class="n">MARGINS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">INDENTATION</span><span class="p">)</span>
<span class="n">DOCUMENT_LANGUAGE</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>

<span class="n">NOTEREFS</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">URLREFS</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">CODEREFS</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">FOOTNOTES</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">FOOTURLS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">CODE</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">RESOLVE_REFERENCES</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">COLOR_ERRORS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">CODEREF_ERRORS</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<div class="warning"><p>
Ces variables globales ont été réfléchies et semblaient la meilleure solution pour éviter de complexifier le code. <span class="bold">Elles ne sont pas <span class="italic">thread-safe</span>.</span> Si vous décidez pour une raison ou une autre de faire fonctionner plusieurs parties de ce code en parallèle, veuillez bien faire attention à ces variables (notamment <span class="textcode"><span class="n">RESOLVE_REFERENCES</span></span>). Si vous trouvez un moyen simple de vous passer de ces variables qui n'augmente pas la complexité du code, et ne diminue pas sa lisibilité, nous vous saurons gré de nous la faire parvenir.</p>
</div>






<h3><a id="sec3.1.3La_suite_du_programme">3.1.3. La suite du programme</a></h3>



<p>
Le programme contient ensuite quelque fonctions utilitaires, qui peuvent servir à différents points de celui-ci. Nous décrirons ces fonctions au fur et à mesure, quand nous en aurons besoin. Viennent ensuite les classes, puis le programme se met en action en instanciant les classes pour lire le fichier et travailler dessus.</p>







<h2><a id="sec3.2Support_de_l_unicode">3.2. Support de l'unicode</a></h2>



<p>
Le support de l'unicode en python 2 est une horreur. Il faut faire attention à bien utiliser des chaînes de type <span class="textcode"><span class="nb">unicode</span></span> au lieu des chaînes de type <span class="textcode"><span class="nb">str</span></span>, et spécifier le type des fichiers ouverts, dont la sortie standard et la sortie d'erreur (et l'entrée standard, mais nous ne sommes pas concernés ici, puisque nous ne la lisons pas).</p>
<p>
Nous commençons par spécifier l'encodage de notre fichier source :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="d_but_d_un_programme_python2">début d'un programme python</a></span><a href="#d_but_d_un_programme_python1"> &lt;-</a> <a href="#coderef1">(1)</a> </div>
<div class="highlight"><pre><span class="c"># -*- encoding: utf-8 -*-</span>
</pre></div>
</div>
<p>
Puis nous importons le module <span class="textcode"><span class="n">codecs</span></span>, et spécifions l'encodage de la sortie standard et de la sortie d'erreur.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="imports2">imports</a></span><a href="#imports1"> &lt;-</a> <a href="#coderef2">(2)</a> </div>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">codecs</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</pre></div>
</div>
<p>
Ensuite, nous créons une fonction utilitaire pour lire un fichier :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="fonctions_utilitaires1">fonctions utilitaires</a></span><a href="#fonctions_utilitaires2"> -&gt;</a> <a href="#coderef4">(4)</a> </div>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8&quot;</span><span class="p">):</span>
	<span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>
<span class="italic">Pour rappel, il n'est pas nécessaire de fermer manuellement le fichier, celui-ci sera fermé à la destruction de l'objet <span class="textcode"><span class="n">f</span></span>, c'est à dire à la sortie de la fonction, <span class="textcode"><span class="n">f</span></span> n'étant plus utilisé.</span></p>
<p>
De la même manière, nous créons une fonctions renvoyant les lignes d'un fichier :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="fonctions_utilitaires2">fonctions utilitaires</a></span><a href="#fonctions_utilitaires1"> &lt;-</a><a href="#fonctions_utilitaires3"> -&gt;</a> <a href="#coderef4">(4)</a> </div>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">readlines</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8&quot;</span><span class="p">):</span>
	<span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</pre></div>
</div>
<p>
Enfin, nous créons une fonction permettant de sauvegarder un fichier :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="fonctions_utilitaires3">fonctions utilitaires</a></span><a href="#fonctions_utilitaires2"> &lt;-</a><a href="#fonctions_utilitaires4"> -&gt;</a> <a href="#coderef4">(4)</a> </div>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8&quot;</span><span class="p">):</span>
	<span class="c">#f = codecs.open(filename, &#39;w&#39;, encoding = encoding)</span>
	<span class="c">#f.write(text)</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>
<span class="italic">Pour le moment, nous n'écrivons pas les fichiers. Les fonctions qui génèrent les chaînes de caractères fournies à <span class="textcode"><span class="n">write</span></span> ne retournent pas encore de texte, et nous avons de manière d'éviter une erreur lors des tests :</span></p>
<ul><li><p>
<span class="italic">commenter chaque appel à la fonction <span class="textcode"><span class="n">write</span></span>,</span></p>
</li><li><p>
<span class="italic">rendre la fonction <span class="textcode"><span class="n">write</span></span> inopérante.</span></p>
</li></ul>
<p>
<span class="italic">Cette dernière solution est bien plus pratique. En attendant que le code soit plus avancé.</span></p>
<p>
Les fonctions <span class="textcode"><span class="n">write</span></span>, <span class="textcode"><span class="n">read</span></span> et <span class="textcode"><span class="n">readlines</span></span> prennent un paramètre optionnel permettant de spécifier l'encodage du fichier. Nous travaillons majoritairement sur des fichiers en UTF-8, c'est donc la valeur par défaut. Un autre encodage utilisé est <span class="textcode"><span class="bp">None</span></span> (pas d'encodage), qui permet de travailler sur les fichiers de manière binaire (voir l'opposition <a href="http://fr.wikipedia.org/wiki/Fichier_binaire" target="about:blank">fichier binaire vs fichier texte</a>)</p>





<h2><a id="sec3.3Actions_principales_du_programme">3.3. Actions principales du programme</a></h2>



<p>
Au lancement, le programme analyse ses paramètres pour savoir quel fichier il va analyser. Si aucun paramètre n'a été passé, le programme quitte en affichant un message d'erreur. De même si le fichier passé en paramètre n'existe pas.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="actions_principales1">actions principales</a></span><a href="#actions_principales2"> -&gt;</a> <a href="#coderef17">(17)</a> <a href="#coderef6">(6)</a> </div>
<div class="highlight"><pre><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
	<span class="n">error</span><span class="p">(</span><span class="s">u&quot;Erreur : aucun fichier passé en paramètre&quot;</span><span class="p">)</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="n">document_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">document_file</span><span class="p">):</span>
	<span class="n">error</span><span class="p">(</span><span class="s">u&quot;</span><span class="si">%s</span><span class="s"> n&#39;existe pas.&quot;</span> <span class="o">%</span> <span class="n">document_file</span><span class="p">)</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</pre></div>
</div>
<p>
Nous déterminons maintenant le nom du document à extraire, et générons les chemins de fichier vers lesquels nous extrairons la documentation et les sources :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="actions_principales2">actions principales</a></span><a href="#actions_principales1"> &lt;-</a><a href="#actions_principales3"> -&gt;</a> <a href="#coderef6">(6)</a> </div>
<div class="highlight"><pre><span class="n">project</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">document_file</span><span class="p">)</span>
<span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">html_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="n">project</span><span class="o">+</span><span class="s">&quot;.html&quot;</span><span class="p">)</span>
<span class="n">ebook_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="n">project</span><span class="o">+</span><span class="s">&quot;.ebook_ready.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>
<span class="italic">Le fichier en </span>.ebook_ready.html<span class="italic"> permet de générer un fichier html dont la css est un peu simplifiée, afin d'être utilisable pour le convertir en ebook (les propriétés modifiant la largeur d'un bloc passent mal sur les petits écrans).</span></p>
<p>
Nous créons un document à partir du fichier passé en paramètre. Ce fichier est parsé, reformaté (ainsi que les fichiers qu'il inclue), les blocs de codes, les références et la structure du document sont préparés.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="actions_principales3">actions principales</a></span><a href="#actions_principales2"> &lt;-</a><a href="#actions_principales4"> -&gt;</a> <a href="#coderef6">(6)</a> </div>
<div class="highlight"><pre><span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">document_file</span><span class="p">)</span>
</pre></div>
</div>
<p>
Maintenant, nous extrayons le code, puis la documentation<a href="#ref8" id="toref8"><sup>8</sup></a> :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="actions_principales4">actions principales</a></span><a href="#actions_principales3"> &lt;-</a><a href="#actions_principales5"> -&gt;</a> <a href="#coderef6">(6)</a> </div>
<div><pre><a id="coderef16" href="#extraction_du_code_source1">extraction du code source</a></pre></div>
<div class="highlight"><pre><span class="n">write</span><span class="p">(</span><span class="n">html_file</span><span class="p">,</span> <span class="n">document</span><span class="o">.</span><span class="n">output_html</span><span class="p">())</span>
<span class="n">write</span><span class="p">(</span><span class="n">ebook_file</span><span class="p">,</span> <span class="n">document</span><span class="o">.</span><span class="n">output_html</span><span class="p">(</span><span class="n">ebook</span> <span class="o">=</span> <span class="bp">True</span><span class="p">))</span>
<span class="n">document</span><span class="o">.</span><span class="n">print_debug</span><span class="p">()</span>
</pre></div>
</div>
<p>
Chaque bloc de code nommé est retenu dans la variable <span class="textcode"><span class="n">CODE</span></span>. Pour extraire le code source, nous parcourons chaque bloc de code nommé, et s'il n'a jamais été référencé, nous l'extrayons :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="extraction_du_code_source1">extraction du code source</a></span> <a href="#coderef16">(16)</a> </div>
<div class="highlight"><pre><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">CODE</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">CODE</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">referenced</span><span class="p">:</span>
        <span class="n">source_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="n">source_file</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CODE</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resolved</span><span class="p">))</span>
</pre></div>
</div>
<p>
<span class="italic"><span class="textcode"><span class="n">CODE</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></span> est séparé en plusieurs blocs (quand le même nom de bloc a été utilisé plusieurs fois). Nous sauvegardons dans le premier bloc le résultat obtenu en résolvant les références. Ce résultat (<span class="textcode"><span class="n">CODE</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resolved</span></span>) est retenu en tant que tableau, chaque élément correspondant à une ligne de code. Pour écrire le code source dans un fichier, nous joignons tout ces éléments par un retour à la ligne (<span class="textcode"><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span> <span class="n">of</span> <span class="nb">str</span><span class="p">)</span></span>).</span></p>
<p>
Enfin, nous affichons les erreurs que nous avons enregistré jusqu'à maintenant :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="actions_principales5">actions principales</a></span><a href="#actions_principales4"> &lt;-</a> <a href="#coderef6">(6)</a> </div>
<div class="highlight"><pre><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">COLOR_ERRORS</span><span class="p">:</span>
    <span class="n">error</span><span class="p">(</span><span class="s">u&quot;Pas de coloration syntaxique pour le langage </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">CODEREF_ERRORS</span><span class="p">:</span>
    <span class="n">error</span><span class="p">(</span><span class="s">u&quot;&lt;Code: </span><span class="si">%s</span><span class="s"> n&#39;existe pas.&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>
<span class="textcode"><span class="n">error</span></span> est une fonction utilitaire affichant un message sur la sortie d'erreur. Voici sa définition :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="fonctions_utilitaires4">fonctions utilitaires</a></span><a href="#fonctions_utilitaires3"> &lt;-</a><a href="#fonctions_utilitaires5"> -&gt;</a> <a href="#coderef4">(4)</a> </div>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="o">+</span><span class="s">u&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>
Au final, voici tout ce que nous faisons lorsque nous lançons le programme :</p>
<div class="codechunk"><div class="codehead">Output of code <a href="#actions_principales1" id="coderef17">actions principales</a>:</div><div class="highlight"><pre><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
	<span class="n">error</span><span class="p">(</span><span class="s">u&quot;Erreur : aucun fichier passé en paramètre&quot;</span><span class="p">)</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="n">document_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">document_file</span><span class="p">):</span>
	<span class="n">error</span><span class="p">(</span><span class="s">u&quot;</span><span class="si">%s</span><span class="s"> n&#39;existe pas.&quot;</span> <span class="o">%</span> <span class="n">document_file</span><span class="p">)</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="n">project</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">document_file</span><span class="p">)</span>
<span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">html_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="n">project</span><span class="o">+</span><span class="s">&quot;.html&quot;</span><span class="p">)</span>
<span class="n">ebook_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="n">project</span><span class="o">+</span><span class="s">&quot;.ebook_ready.html&quot;</span><span class="p">)</span>

<span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">document_file</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">CODE</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">CODE</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">referenced</span><span class="p">:</span>
        <span class="n">source_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="n">source_file</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CODE</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resolved</span><span class="p">))</span>
<span class="n">write</span><span class="p">(</span><span class="n">html_file</span><span class="p">,</span> <span class="n">document</span><span class="o">.</span><span class="n">output_html</span><span class="p">())</span>
<span class="n">write</span><span class="p">(</span><span class="n">ebook_file</span><span class="p">,</span> <span class="n">document</span><span class="o">.</span><span class="n">output_html</span><span class="p">(</span><span class="n">ebook</span> <span class="o">=</span> <span class="bp">True</span><span class="p">))</span>
<span class="n">document</span><span class="o">.</span><span class="n">print_debug</span><span class="p">()</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">COLOR_ERRORS</span><span class="p">:</span>
    <span class="n">error</span><span class="p">(</span><span class="s">u&quot;Pas de coloration syntaxique pour le langage </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">CODEREF_ERRORS</span><span class="p">:</span>
    <span class="n">error</span><span class="p">(</span><span class="s">u&quot;&lt;Code: </span><span class="si">%s</span><span class="s"> n&#39;existe pas.&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>





<h2><a id="sec3.4Structure_d_un_document">3.4. Structure d'un document</a></h2>



<p>
Afin de comprendre le découpage en classes qui va suivre, il est nécessaire de parler un peu de la composition d'un document, et du processus de découpage de celui-ci nécessaire pour en extraire la structure.</p>



<h3><a id="sec3.4.1Les_sections">3.4.1. Les sections</a></h3>



<p>
Nous avons tout d'abord le document. Entier. Ce document est composé de plusieurs sections (nous ne considérons ici que les sections, et pas les sous-sections).</p>
<p>
Une section est constituée principalement de cinq choses :</p>
<ul><li><p>
une section parente, qui permet de savoir à quel niveau de profondeur nous sommes,</p>
</li><li><p>
un numéro de section,</p>
</li><li><p>
un titre,</p>
</li><li><p>
une introduction,</p>
</li><li><p>
une liste de sous-sections</p>
</li></ul>
<p>
Chaque section commence par une introduction. Tout le texte précédent la première sous-section fait partie de l'introduction. Ensuite, nous regardons chaque sous-section et la plaçons dans une liste, qui suivra l'introduction.</p>
<p>
Les sous-sections ne sont pas différentes des sections. Elles contiennent elles-même une introduction, et d'autre sous-sections, et ainsi de suite.</p>
<p>
On distingue trois types de sections :</p>
<ul><li><p>
Tout d'abord, le document lui même est composé comme une section, c'est à dire qu'il contient une introduction, puis une liste de sections. La différence est qu'en tant que <span class="bold">section mère</span>, elle contient des informations supplémentaires, telles que le ou les auteurs du document, le titre, le langage de programmation du projet… Cette section aura aussi un rendu différent lorsque nous générerons la documentation.</p>
</li><li><p>
Ensuite, viennent les <span class="bold">sections</span> à proprement parler. Celles-ci sont telles que décrites plus tôt, composées d'une introduction et d'une suite de sous-sections.</p>
</li><li><p>
Enfin, il y a les <span class="bold">sections terminales</span>. Ces sections n'ont pas de réelle différence avec les sections, si ce n'est qu'elles ne contiennent pas de sous-section – c'est à dire qu'elles ne comportent qu'une introduction.</p>
</li></ul>





<h3><a id="sec3.4.2Les_introductions">3.4.2. Les introductions</a></h3>



<p>
Une fois les sections extraites, nous n'avons plus à nous occuper que des introductions de celles-ci, les autres parties étant soit des sections elles-mêmes, soit déjà analysées.</p>
<p>
Une introduction va contenir des paragraphes de documentation, et des morceaux de code. Le traitement de ces deux parties sera extrêmement différent. Lors de l'analyse, nous séparons donc ces parties. À l'issue de l'analyse, une introduction est composée d'une suite de paragraphes et de morceaux de code. Toutefois, deviner quand se termine et quand commence un paragraphe est, au contraire des blocs de code, assez difficile. Nous passons donc par une structure intermédiaire, la <span class="bold">documentation</span>, qui va contenir plusieurs paragraphes, plutôt que de découper les paragraphes directement dans l'introduction.</p>





<h3><a id="sec3.4.3Les_blocs_de_code">3.4.3. Les blocs de code</a></h3>



<p>
Les blocs de codes sont composés d'une suite de lignes de codes et de références vers d'autres blocs de code. Un bloc de code peut avoir un nom (pour des références futures) et nous pouvons spécifier au cas par cas le langage de programmation d'un bloc de code (qui par défaut est celui du projet).</p>





<h3><a id="sec3.4.4La_documentation">3.4.4. La documentation</a></h3>



<p>
La documentation est composée d'une suite de paragraphes. Ces paragraphes peuvent être de plusieurs sorte :</p>
<ul><li><p>
des paragraphes simples,</p>
</li><li><p>
des listes,</p>
</li><li><p>
des paragraphes importants,</p>
</li><li><p>
des notes de bas de page ou des URLs,</p>
</li><li><p>
des commandes.</p>
</li></ul>
<p>
Une partie de ces types de paragraphes peuvent eux même être composés de documentation. Par exemple, un paragraphe important va contenir une documentation, ce qui lui permettra de contenir à sont tour des listes. Les listes elles-même contiennent une documentation, leur permettant ainsi de contenir des sous-listes, ou des… paragraphes importants. Ou tout simplement, plusieurs paragraphes. La note de bas de page ne contient pas une documentation, mais un – et un seul – paragraphe.</p>
<div class="warning"><p>
Même s'il est théoriquement possible d'insérer des notes de bas de page, des URLs, ou des commandes dans les listes et les paragraphes importants, le comportement pourrait être imprévisible. C'est donc fortement déconseillé. Et de toute façon peu intuitif pour les futures lectures, une commande étant censée se trouver seule sur une ligne.</p>
</div>




<h3><a id="sec3.4.5Les_paragraphes">3.4.5. Les paragraphes</a></h3>



<p>
Les paragraphes sont des suites de lignes consécutives. Ils sont séparés les uns des autres par une ligne vide. Ce qui nous intéresse ici est qu'ils contiennent eux-même des éléments de formatage. On peut considérer qu'un paragraphe contient deux type de donnée :</p>
<ul><li><p>
des morceaux de texte brut,</p>
</li><li><p>
des passages formatés.</p>
</li></ul>
<p>
Les passages formatés peuvent contenir, eux aussi, des morceaux de texte brut et des passages formatés. Au final, cette arborescence de donnée sera toujours terminée, à chaque <span class="italic">feuille</span>, par un bloc de texte brut.</p>





<h3><a id="sec3.4.6Pour_r_sumer">3.4.6. Pour résumer</a></h3>



<p>
Nous avons donc un <span class="bold">document</span>, contenant des <span class="bold">sections</span>, contenant une <span class="bold">introduction</span> et des sous-sections. L'introduction contient du <span class="bold">code</span> (contenant des <span class="bold">lignes de code</span> et des <span class="bold">références vers des blocs de code</span>) et de la <span class="bold">documentation</span>, et celle-ci contient des <span class="bold">paragraphes</span>, des <span class="bold">listes</span>, des <span class="bold">paragraphes importants</span>, des <span class="bold">notes de bas de page</span>, des <span class="bold">URLs</span> et des <span class="bold">commandes</span>. Les paragraphes contiennent des <span class="bold">blocs de texte brut</span>, et des <span class="bold">blocs formatés</span>. Les autres éléments de la documentation contiennent des paragraphes ou de la documentation.</p>
<p>
Présenté avec plus de formes, voici la structure d'un document :</p>
<ul><li><p>
Document</p>
<ul><li><p>
Titre</p>
</li><li><p>
Auteurs</p>
</li><li><p>
Langage de programmation du projet</p>
</li><li><p>
Résumé</p>
<ul><li><p>
Documentation</p>
<ul><li><p>
Paragraphes</p>
<ul><li><p>
Blocs de texte brut</p>
</li><li><p>
Blocs de texte formatés</p>
<ul><li><p>
Blocs de texte brut</p>
</li><li><p>
Blocs de texte formatés</p>
<ul><li><p>
[…]</p>
</li></ul>
</li></ul>
</li></ul>
</li><li><p>
Listes</p>
<ul><li><p>
Documentation</p>
<ul><li><p>
[…]</p>
</li></ul>
</li></ul>
</li><li><p>
Paragraphes importants</p>
<ul><li><p>
Documentation</p>
<ul><li><p>
[…]</p>
</li></ul>
</li></ul>
</li><li><p>
Notes de bas de page</p>
<ul><li><p>
Paragraphe</p>
<ul><li><p>
[…]</p>
</li></ul>
</li></ul>
</li><li><p>
URLs</p>
</li><li><p>
Commandes</p>
</li></ul>
</li></ul>
</li><li><p>
Licence</p>
<ul><li><p>
Documentation</p>
<ul><li><p>
[…]</p>
</li></ul>
</li></ul>
</li><li><p>
Introduction</p>
<ul><li><p>
Documentations</p>
<ul><li><p>
[…]</p>
</li></ul>
</li><li><p>
Codes</p>
<ul><li><p>
Lignes de code</p>
</li><li><p>
Références vers des blocs de code</p>
</li></ul>
</li></ul>
</li><li><p>
Sections</p>
<ul><li><p>
Nom</p>
</li><li><p>
Numéro</p>
</li><li><p>
Parent</p>
</li><li><p>
Introduction</p>
<ul><li><p>
[…]</p>
</li></ul>
</li><li><p>
Sous-sections</p>
<ul><li><p>
[…]</p>
</li></ul>
</li></ul>
</li></ul>
</li></ul>
<div class="warning"><p>
Ceci ne représente pas l'arborescence des classes. La plupart des éléments présentés ici n'ont pas de classe parente commune (à part peut-être <span class="textcode"><span class="nb">object</span></span>), et même, la classe <span class="textcode"><span class="n">Document</span></span> hérite de la classe <span class="textcode"><span class="n">Section</span></span> alors que notre arborescence <span class="italic">montre l'inverse</span>. Bref, ne confondez pas l'arborescence du document et celle des classes.</p>
</div>






<h2><a id="sec3.5Gestion_des_documents">3.5. Gestion des documents</a></h2>



<p>
Dans cette partie, nous traitons de la gestion des documents. Nous expliquerons ici comment nous chargeons un document, et le découpons en sous parties, en blocs de code et en blocs de documentation. Pour cela, nous définirons trois classes :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="gestion_des_documents1">gestion des documents</a></span> <a href="#coderef9">(9)</a> </div>
<div><pre><a id="coderef18" href="#classe_Introduction1">classe Introduction</a></pre></div>
<div><pre><a id="coderef19" href="#classe_Section1">classe Section</a></pre></div>
<div><pre><a id="coderef20" href="#classe_Document1">classe Document</a></pre></div>
</div>



<h3><a id="sec3.5.1La_classe_Document">3.5.1. La classe Document</a></h3>



<p>
la classe <span class="textcode"><span class="n">Document</span></span> est une sous-classe de <span class="textcode"><span class="n">Section</span></span>, un document étant une section qui a réussit. Nous parlons d'elle en premier car c'est la première classe que nous utilisons dans le programme. Ce qui nous intéresse ici n'est d'ailleurs pas son travail en tant que section, mais bien son travail en tant que document.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="classe_Document1">classe Document</a></span> <a href="#coderef20">(20)</a> </div>
<div><pre><a id="coderef21" href="#classes_utiles___la_classe_Document1">classes utiles à la classe Document</a></pre></div>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">parse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="n">Section</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
<div><pre>        <a id="coderef22" href="#variables_sp_cifiques_au_document1">variables spécifiques au document</a></pre></div>
<div><pre>        <a id="coderef23" href="#__la_cr_ation_d_un_document1">à la création d'un document</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef24" href="#extraire_les_informations_sp_cifiques_au_document1">extraire les informations spécifiques au document</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef25" href="#formater_un_document1">formater un document</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ebook</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef26" href="#sortir_un_document_en_html1">sortir un document en html</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef27" href="#afficher_la_structure_d_un_document1">afficher la structure d'un document</a></pre></div>
<div class="highlight"><pre>
</pre></div>
</div>
<p>
<span class="italic">La fonction d'initialisation de la classe <span class="textcode"><span class="n">Document</span></span> prend un argument optionnel, <span class="textcode"><span class="n">parse</span></span>. Cet argument est utilisé par la fonction elle même : au moment de charger les fichiers incluts par <span class="textcode">~Get</span>, <span class="textcode"><span class="n">__init__</span><span class="p">()</span></span> crée un <span class="textcode"><span class="n">Document</span></span> et récupère les lignes qu'il a chargé. Cette fonction permet d'éviter de parser le document pour rien (seules les lignes incluses nous intéressent).</span></p>
<p>
Notre document possède quelques atout en plus que la section : un titre, des auteurs, un résumé, une licence. Le titre et les auteurs sont conservés dans une classe sur mesure, d'où la référence vers un bloc de code <span class="italic">classes utiles à la classe Document</span>. Voici comment sont initialisées les variables supplémentaires de la classe Document :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="variables_sp_cifiques_au_document1">variables spécifiques au document</a></span> <a href="#coderef22">(22)</a> </div>
<div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">=</span> <span class="n">Authors</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">None</span>
<span class="bp">self</span><span class="o">.</span><span class="n">abstract</span> <span class="o">=</span> <span class="bp">None</span>
<span class="bp">self</span><span class="o">.</span><span class="n">license</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
<p>
À la création d'un document, nous faisons plusieurs actions :</p>
<ul><li><p>
tout d'abord, nous cherchons les commandes <span class="textcode">~Get</span> pour insérer leur contenu dans le document,<a href="#ref9" id="toref9"><sup>9</sup></a></p>
</li><li><p>
ceci fait, nous analysons le document pour en extraire la structure,</p>
</li><li><p>
enfin, nous résolvons les références, c'est à dire que nous déterminons le nom des références et, dans le cas du code, remplaçons les références par leur contenu.</p>
</li></ul>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="__la_cr_ation_d_un_document1">à la création d'un document</a></span> <a href="#coderef44">(44)</a> <a href="#coderef23">(23)</a> </div>
<div><pre><a id="coderef28" href="#charger_le_fichier1">charger le fichier</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef29" href="#formater_le_fichier_source1">formater le fichier source</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef30" href="#analyser_les_fichiers_inclus1">analyser les fichiers inclus</a></pre></div>
<div class="highlight"><pre>
</pre></div>
<div><pre><a id="coderef31" href="#analyser_le_document_entier1">analyser le document entier</a></pre></div>
</div>
<p>
Nous attaquons ici véritablement les spécificités de la classe <span class="textcode"><span class="n">Document</span></span>. Si vous n'avez pas encore deviné, voici ce qu'elle fait en plus que la classe <span class="textcode"><span class="n">Section</span></span> :</p>
<ul><li><p>
elle charge le fichier passé en paramètre (et les fichiers qu'il inclue),</p>
</li><li><p>
elle extrait le titre, le résumé, la licence et les auteurs du document,</p>
</li><li><p>
elle propose un fichier source reformaté de chaque fichier inclus et du fichier original, pour une lecture plus agréable.</p>
</li></ul>
<p>
Après ça, notre classe va se comporter comme une section normale.</p>



<h4><a id="sec3.5.1.1Formater_le_fichier_source">3.5.1.1. Formater le fichier source</a></h4>



<p>
Lorsque nous chargeons un document, nous formatons le fichier source de ce document et sauvegardons à côté de celui-ci le résultat de ce formatage (s'il est différent du fichier original), ce qui permettra de vérifier qu'aucune erreur ne s'est glissée dans le fichier formaté avant de remplacer le fichier original par celui-ci.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="formater_le_fichier_source1">formater le fichier source</a></span> <a href="#coderef29">(29)</a> </div>
<div class="highlight"><pre><span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span>
<span class="n">output_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_text</span><span class="p">()</span>
<span class="n">input_text</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="k">if</span> <span class="n">output_text</span> <span class="o">!=</span> <span class="n">input_text</span><span class="p">:</span>
    <span class="n">write</span><span class="p">(</span><span class="n">file_name</span><span class="o">+</span><span class="s">&quot;.clean&quot;</span><span class="p">,</span> <span class="n">output_text</span><span class="p">)</span>
</pre></div>
</div>
<p>
Nous faisons ici face à une possible erreur dans l'architecture : la classe <span class="textcode"><span class="n">Document</span></span> hérite de la classe <span class="textcode"><span class="n">Section</span></span>. Pour analyser le contenu d'un document, nous commençons par extraire les informations spécifiques au document, puis nous laissons les lignes restantes à la classe parente. Ce faisant, nous avons supprimé des lignes de la classe <span class="textcode"><span class="n">Document</span></span>. Mais nous allons encore travailler avec ces lignes. Aussi, nous les sauvegardons (<span class="textcode"><span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span></span>) et nous les restituons après avoir parsé le fichier (<span class="textcode"><span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span></span>) – n'oubliez pas : ici, nous parsons le fichier, plus loin, nous parsons le document entier.</p>





<h4><a id="sec3.5.1.2Charger_le_fichier">3.5.1.2. Charger le fichier</a></h4>



<p>
Nous chargeons le fichier. Cette partie est assez simple : nous nous contentons d'extraire les lignes du fichier dans une variable, <span class="textcode"><span class="bp">self</span><span class="o">.</span><span class="n">lines</span></span> (qui est héritée de la classe <span class="textcode"><span class="n">Section</span></span>, voir <a href="#self.lines_dans_les_sections">cette partie</a> pour comprendre son usage :)</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="charger_le_fichier1">charger le fichier</a></span> <a href="#coderef28">(28)</a> </div>
<div class="highlight"><pre><span class="n">file_name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="n">dir_name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">readlines</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
</pre></div>
</div>
<p>
<span class="italic">Nous utilisons le chemin absolu vers le fichier. Nous en profitons d'ailleurs pour récupérer le nom du dossier dans lequel se situe notre fichier.</span></p>
<p>
Une fois ces lignes chargées, nous devons nous débrouiller pour charger les fichiers référencés dans ce fichier, et en insérer les lignes dans le document en cours. Pour compliquer la chose, si nous incluons un fichier, nous voulons que les commandes de celui-ci ayant pour paramètre des noms de fichier soient modifiées, afin de transformer le nom de fichier relatif en nom de fichier absolu : nous ne connaissons en effet la position du fichier en cours de chargement que dans cette partie du programme, mais nous devrons traiter ces chemins relativement au fichier en cours de traitement, ce qui peut poser des problèmes si le fichier est dans un dossier différent du répertoire de travail (où la commande a été lancée).</p>
<p>
<a id="premi_re_d_finition_de___ignorer_les_blocs_de_code__"></a></p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="analyser_les_fichiers_inclus1">analyser les fichiers inclus</a></span> <a href="#coderef41">(41)</a> <a href="#coderef30">(30)</a> </div>
<div class="highlight"><pre><span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
</pre></div>
<div><pre>    <a id="coderef32" href="#ignorer_les_blocs_de_code1">ignorer les blocs de code</a></pre></div>
<div><pre>    <a id="coderef33" href="#g_rer_les_~Get1">gérer les ~Get</a></pre></div>
<div><pre>    <a id="coderef34" href="#g_rer_les_~Include_et_~Image1">gérer les ~Include et ~Image</a></pre></div>
<div><pre>    <a id="coderef35" href="#g_rer_les_~Copy1">gérer les ~Copy</a></pre></div>
<div><pre>    <a id="coderef36" href="#g_rer_les_autres_cas1">gérer les autres cas</a></pre></div>
<div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">new_lines</span>
</pre></div>
</div>
<p>
Ceci fait, nous analysons pour de bon le document :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="analyser_le_document_entier1">analyser le document entier</a></span> <a href="#coderef31">(31)</a> </div>
<div class="highlight"><pre><span class="k">if</span> <span class="n">parse</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">RESOLVE_REFERENCES</span>
    <span class="n">RESOLVE_REFERENCES</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
    <span class="c">#self.resolv()</span>
</pre></div>
</div>
<p>
<span class="italic">Jusqu'à maintenant, nous avons récupéré des fichiers sans jamais résoudre les références (certaines références sont résolues au moment du parsing, et comme nous parsons le fichier deux fois, nous devons éviter de commencer à résoudre les références la première fois). La variable globale <span class="textcode"><span class="n">RESOLVE_REFERENCES</span></span> permet d'indiquer que cette fois, c'est bon, on doit prendre en compte les références.</span></p>
<p>
<span class="italic">Nous ne resolvons pas encore les référence, car cette fonction n'est pas encore implémentée.</span></p>



<h5><a id="sec3.5.1.2.1Ignorer_les_blocs_de_code">3.5.1.2.1. Ignorer les blocs de code</a></h5>



<p>
Vous avez pu remarquer que nous avons définit une variable <span class="textcode"><span class="n">mode</span></span>. Sont but est simple : nous permettre de ne pas interpréter les <span class="textcode">~Get</span> et autres joyeusetés lorsqu'ils font partie d'un bloc de code (les blocs de code ne sont <span class="bold">jamais interprétés</span>).</p>
<p>
Avant toute chose, si cette variable contient la chaîne <span class="textcode"><span class="s">&quot;code&quot;</span></span>, nous ne faisons qu'une chose : vérifier si on sort de ce mode. Toutes les autres actions seront conditionnées par un <span class="textcode"><span class="k">elif</span></span> ou un <span class="textcode"><span class="k">else</span></span>, ce qui fait qu'elles ne seront jamais exécutées si le mode est <span class="textcode"><span class="s">&quot;code&quot;</span></span>.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="ignorer_les_blocs_de_code1">ignorer les blocs de code</a></span><a href="#ignorer_les_blocs_de_code2"> -&gt;</a> <a href="#coderef47">(47)</a> <a href="#coderef32">(32)</a> <a href="#coderef46">(46)</a> </div>
<div class="highlight"><pre><span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;code&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>
<span class="italic">On sort du mode <span class="textcode"><span class="s">&quot;code&quot;</span></span> si la ligne contient juste un <span class="textcode"><span class="s">&quot;&gt;&quot;</span></span>. Quoi qu'il arrive, nous ajoutons la ligne aux lignes du document final, car nous en aurons encore l'usage.</span></p>
<p>
Si nous ne sommes pas encore en mode <span class="textcode"><span class="s">&quot;code&quot;</span></span>, il faut vérifier que nous n'y entrons pas :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="ignorer_les_blocs_de_code2">ignorer les blocs de code</a></span><a href="#ignorer_les_blocs_de_code1"> &lt;-</a> <a href="#coderef32">(32)</a> <a href="#coderef46">(46)</a> </div>
<div class="highlight"><pre><span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;&lt;code&quot;</span><span class="p">):</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;code&quot;</span>
    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>





<h5><a id="sec3.5.1.2.2G_rer_les_~Get">3.5.1.2.2. Gérer les ~Get</a></h5>



<p>
Si la ligne commence par <span class="textcode">~Get</span>, nous créons un <span class="textcode"><span class="n">Document</span></span> qui contient le contenu pointé par <span class="textcode">~Get</span>, puis nous lui « volons » ses lignes en les insérant dans le document en cours. Dans le cas où le fichier n'existe pas, nous affichons une erreur.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="g_rer_les_~Get1">gérer les ~Get</a></span> <a href="#coderef33">(33)</a> </div>
<div class="highlight"><pre><span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~get&quot;</span><span class="p">):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">get_file</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">get_file_abs</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">get_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">get_file</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&quot;Un get n&#39;a pas d&#39;argument.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">get_file_abs</span><span class="p">):</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&quot;Fichier non trouvé : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">get_file_abs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">get_file_abs</span><span class="p">,</span> <span class="n">parse</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">new_lines</span> <span class="o">+=</span> <span class="n">document</span><span class="o">.</span><span class="n">lines</span>
</pre></div>
</div>
<p>
<span class="italic">Nous ne faisons que charger le fichier pour récupérer ses lignes (et celles des fichiers qu'il inclue), nous pouvons nous passer d'analyser la structure du document que contient ce fichier, car nous allons l'analyser dans le document en cours. C'est pour cette raison que nous passons l'argument <span class="textcode"><span class="n">parse</span> <span class="o">=</span> <span class="bp">False</span></span> : l'analyse étant inutile, nous gagnons du temps en ne la faisant pas.</span></p>





<h5><a id="sec3.5.1.2.3G_rer_les_~Include_et_~Image">3.5.1.2.3. Gérer les ~Include et ~Image</a></h5>



<p>
Si la ligne commence par <span class="textcode">~Include</span> ou <span class="textcode">~Image</span>, nous nous contentons de modifier le chemin d'accès au fichier pointé pour le rendre absolu. Nous utilisons deux blocs <span class="textcode"><span class="k">elif</span></span>, car vous remarquerez que les deux commandes ne font pas la même taille, ce qui est gênant pour récupérer le chemin de fichier (Une solution à base de <span class="textcode"><span class="n">split</span><span class="p">()</span></span> existe, mais ne serait intéressante que si nous avions plus de cas à gérer. Ici, l'utiliser reviendrais à complexifier le système pour rien.).</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="g_rer_les_~Include_et_~Image1">gérer les ~Include et ~Image</a></span> <a href="#coderef34">(34)</a> </div>
<div class="highlight"><pre><span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~include&quot;</span><span class="p">):</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;~include &quot;</span><span class="o">+</span><span class="n">file_path</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~image&quot;</span><span class="p">):</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;~image &quot;</span><span class="o">+</span><span class="n">file_path</span><span class="p">)</span>
</pre></div>
</div>





<h5><a id="sec3.5.1.2.4G_rer_les_~Copy">3.5.1.2.4. Gérer les ~Copy</a></h5>



<p>
Dans le cas de la commande <span class="textcode">~Copy</span>, elle est, comme <span class="textcode">~Get</span>, traitée tout de suite. Son fonctionnement est un peu spécial par rapport aux autres commandes, car elle prend en paramètre deux noms de fichier. De plus, la ligne contenant cette commande n'est pas retenue.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="g_rer_les_~Copy1">gérer les ~Copy</a></span> <a href="#coderef40">(40)</a> <a href="#coderef35">(35)</a> </div>
<div class="highlight"><pre><span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~copy&quot;</span><span class="p">):</span>
</pre></div>
<div><pre>    <a id="coderef37" href="#~Copy:_d_terminer_les_fichiers1">~Copy: déterminer les fichiers</a></pre></div>
<div><pre>    <a id="coderef38" href="#~Copy:_le_fichier_source_existe__1">~Copy: le fichier source existe ?</a></pre></div>
</div>
<p>
Nous commençons par extraire les chemins de fichier de la commande. Ces chemins peuvent contenir des espaces à condition qu'ils soient échappées (chaque espace doit être précédé d'un <span class="textcode">\</span>). <span class="italic">(voir la fonction <span class="textcode"><span class="n">split_path</span><span class="p">()</span></span> <a href="#fonction_split_path">plus loin</a>.)</span></p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="~Copy:_d_terminer_les_fichiers1">~Copy: déterminer les fichiers</a></span> <a href="#coderef37">(37)</a> </div>
<div class="highlight"><pre><span class="n">files</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
<span class="n">from_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">to_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>
Nous vérifions ensuite que le fichier à copier existe. De même pour le dossier de destination, que nous créons si ce n'est pas le cas.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="~Copy:_le_fichier_source_existe__1">~Copy: le fichier source existe ?</a></span> <a href="#coderef38">(38)</a> </div>
<div class="highlight"><pre><span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">from_file</span><span class="p">):</span>
    <span class="n">error</span><span class="p">(</span><span class="s">&quot;Fichier non trouvé : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">from_file</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
</pre></div>
<div><pre>    <a id="coderef39" href="#~Copy:_si_le_fichier_source_existe1">~Copy: si le fichier source existe</a></pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="~Copy:_si_le_fichier_source_existe1">~Copy: si le fichier source existe</a></span><a href="#~Copy:_si_le_fichier_source_existe2"> -&gt;</a> <a href="#coderef39">(39)</a> </div>
<div class="highlight"><pre><span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to_file</span><span class="p">)):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to_file</span><span class="p">))</span>
</pre></div>
</div>
<p>
Maintenant, que nous savons que le fichier source existe, ainsi que le repertoire de destination, nous n'avons plus qu'à copier :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="~Copy:_si_le_fichier_source_existe2">~Copy: si le fichier source existe</a></span><a href="#~Copy:_si_le_fichier_source_existe1"> &lt;-</a> <a href="#coderef39">(39)</a> </div>
<div class="highlight"><pre><span class="n">write</span><span class="p">(</span><span class="n">to_file</span><span class="p">,</span> <span class="n">read</span><span class="p">(</span><span class="n">from_file</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p>
<span class="italic">Les fonctions <span class="textcode"><span class="n">write</span></span> et <span class="textcode"><span class="n">read</span></span> lisent les fichiers par défaut en UTF-8. Comme nous copions juste un fichier binaire, l'encodage peut poser problème. Nous le spécifions donc à <span class="textcode"><span class="bp">None</span></span>, ce qui signifie que l'on ne gère pas l'encodage, le fichier est donc copié octet par octet.</span></p>
<p>
Cette partie de code ressemble donc à ceci :</p>
<div class="codechunk"><div class="codehead">Output of code <a href="#g_rer_les_~Copy1" id="coderef40">gérer les ~Copy</a>:</div><div class="highlight"><pre><span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~copy&quot;</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">from_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">to_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">from_file</span><span class="p">):</span>
        <span class="n">error</span><span class="p">(</span><span class="s">&quot;Fichier non trouvé : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">from_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to_file</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to_file</span><span class="p">))</span>
        <span class="n">write</span><span class="p">(</span><span class="n">to_file</span><span class="p">,</span> <span class="n">read</span><span class="p">(</span><span class="n">from_file</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p>
Enfin, nous avons utilisé la fonction <span class="textcode"><span class="n">split_path</span><span class="p">()</span></span>. <a id="fonction_split_path"></a> Voici son fonctionnement :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="fonctions_utilitaires5">fonctions utilitaires</a></span><a href="#fonctions_utilitaires4"> &lt;-</a><a href="#fonctions_utilitaires6"> -&gt;</a> <a href="#coderef4">(4)</a> </div>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">split_path</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">escaping</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">word</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">escaping</span><span class="p">:</span> 
            <span class="n">word</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="n">escaping</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="n">escaping</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
            <span class="n">word</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>
<span class="italic">Cette fonction agit comme un <span class="textcode"><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span></span>, à ceci près que les caractères précédés d'un <span class="textcode">\</span> sont ignorés.</span></p>





<h5><a id="sec3.5.1.2.5G_rer_les_autres_cas">3.5.1.2.5. Gérer les autres cas</a></h5>



<p>
Si nous n'avons pas croisé de <span class="textcode">~Get</span>, <span class="textcode">~include</span> ou autre, nous nous contentons d'ajouter la ligne dans les lignes finales :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="g_rer_les_autres_cas1">gérer les autres cas</a></span> <a href="#coderef36">(36)</a> </div>
<div class="highlight"><pre><span class="k">else</span><span class="p">:</span>
    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>





<h5><a id="sec3.5.1.2.6Analyser_les_fichiers_inclus">3.5.1.2.6. Analyser les fichiers inclus</a></h5>



<p>
Voici au final comment nous analysons les fichiers inclus :</p>
<div class="codechunk"><div class="codehead">Output of code <a href="#analyser_les_fichiers_inclus1" id="coderef41">analyser les fichiers inclus</a>:</div><div class="highlight"><pre><span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;code&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;&lt;code&quot;</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;code&quot;</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~get&quot;</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">get_file</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">get_file_abs</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">get_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get_file</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s">&quot;Un get n&#39;a pas d&#39;argument.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">get_file_abs</span><span class="p">):</span>
            <span class="n">error</span><span class="p">(</span><span class="s">&quot;Fichier non trouvé : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">get_file_abs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">get_file_abs</span><span class="p">,</span> <span class="n">parse</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">new_lines</span> <span class="o">+=</span> <span class="n">document</span><span class="o">.</span><span class="n">lines</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~include&quot;</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;~include &quot;</span><span class="o">+</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~image&quot;</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;~image &quot;</span><span class="o">+</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~copy&quot;</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">from_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">to_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">from_file</span><span class="p">):</span>
            <span class="n">error</span><span class="p">(</span><span class="s">&quot;Fichier non trouvé : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">from_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to_file</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to_file</span><span class="p">))</span>
            <span class="n">write</span><span class="p">(</span><span class="n">to_file</span><span class="p">,</span> <span class="n">read</span><span class="p">(</span><span class="n">from_file</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">new_lines</span>
</pre></div>
</div>
<p>
<a id="fonction_begin"></a></p>





<h5><a id="sec3.5.1.2.7La_fonction_begin()">3.5.1.2.7. La fonction begin()</a></h5>



<p>
La fonction <span class="textcode"><span class="n">begin</span><span class="p">()</span></span>, utilisée dans les morceaux de code précédents et tout au long du programme, vérifie si une ligne commence par un texte, ou par l'un des textes fournits en paramètre. Elle accepte comme paramètre une chaîne de caractères ou un tableau. Voici sa définition :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="fonctions_utilitaires6">fonctions utilitaires</a></span><a href="#fonctions_utilitaires5"> &lt;-</a><a href="#fonctions_utilitaires7"> -&gt;</a> <a href="#coderef4">(4)</a> </div>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">texts</span><span class="p">):</span>
</pre></div>
<div><pre>    <a id="coderef42" href="#begin:_g_rer_deux_types_de_param_tre1">begin: gérer deux types de paramètre</a></pre></div>
<div class="highlight"><pre>    <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">:</span>
</pre></div>
<div><pre>        <a id="coderef43" href="#begin:_v_rifier_si_la_ligne_commence_par_ce_texte1">begin: vérifier si la ligne commence par ce texte</a></pre></div>
<div class="highlight"><pre>    <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
<p>
<span class="italic">Nous retournerons <span class="textcode"><span class="bp">True</span></span> dans la boucle <span class="textcode"><span class="k">for</span></span>, si le texte correspond. Si nous atteignons la fin de la boucle, c'est que rien ne correspond, nous retournons donc <span class="textcode"><span class="bp">False</span></span>.</span></p>
<p>
Pour gérer les deux types de paramètre, nous nous contentons de vérifier si le paramètre est une chaine de caractère, et si c'est le cas, de le remplacer par un tableau contenant seulement cette chaîne.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="begin:_g_rer_deux_types_de_param_tre1">begin: gérer deux types de paramètre</a></span> <a href="#coderef42">(42)</a> </div>
<div class="highlight"><pre><span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">texts</span><span class="p">]</span>
</pre></div>
</div>
<p>
Pour vérifier que la ligne débute par le texte, nous vérifons tout d'abord qu'elle est plus grande que ce texte (elle ne peux pas débuter par ce texte si elle est plus courte que lui). Ensuite, nous comparons les premiers caractères de la ligne avec le texte :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="begin:_v_rifier_si_la_ligne_commence_par_ce_texte1">begin: vérifier si la ligne commence par ce texte</a></span> <a href="#coderef43">(43)</a> </div>
<div class="highlight"><pre><span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span> <span class="o">==</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>
<span class="italic">Nous utilisons cette fonctions pour vérifier qu'une ligne commence par une commande. Les commandes sont insensibles à la casse. Comme aucun autre cas demandant d'être sensible à la casse ne s'est présenté, nous nous épargnons de futures mises en minuscule en les pratiquant ici. La même remarque s'applique à propos du <span class="textcode"><span class="n">strip</span><span class="p">()</span></span>.</span></p>
<p>
Voici la fonction entière :</p>
<div class="codechunk"><div class="codehead">Code :  </div>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">texts</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">texts</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span> <span class="o">==</span> <span class="n">text</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>







<h4><a id="sec3.5.1.3R_capitulatif_de_la_cr_ation_d_un_document">3.5.1.3. Récapitulatif de la création d'un document</a></h4>



<p>
Pour récapituler, voici ce qui se passe quand on crée un document :</p>
<div class="codechunk"><div class="codehead">Output of code <a href="#__la_cr_ation_d_un_document1" id="coderef44">à la création d'un document</a>:</div><div class="highlight"><pre><span class="n">file_name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="n">dir_name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">readlines</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

<span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span>
<span class="n">output_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_text</span><span class="p">()</span>
<span class="n">input_text</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="k">if</span> <span class="n">output_text</span> <span class="o">!=</span> <span class="n">input_text</span><span class="p">:</span>
    <span class="n">write</span><span class="p">(</span><span class="n">file_name</span><span class="o">+</span><span class="s">&quot;.clean&quot;</span><span class="p">,</span> <span class="n">output_text</span><span class="p">)</span>

<span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;code&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;&lt;code&quot;</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;code&quot;</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~get&quot;</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">get_file</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">get_file_abs</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">get_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get_file</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s">&quot;Un get n&#39;a pas d&#39;argument.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">get_file_abs</span><span class="p">):</span>
            <span class="n">error</span><span class="p">(</span><span class="s">&quot;Fichier non trouvé : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">get_file_abs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">get_file_abs</span><span class="p">,</span> <span class="n">parse</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">new_lines</span> <span class="o">+=</span> <span class="n">document</span><span class="o">.</span><span class="n">lines</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~include&quot;</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;~include &quot;</span><span class="o">+</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~image&quot;</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;~image &quot;</span><span class="o">+</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~copy&quot;</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">from_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">to_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">from_file</span><span class="p">):</span>
            <span class="n">error</span><span class="p">(</span><span class="s">&quot;Fichier non trouvé : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">from_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to_file</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to_file</span><span class="p">))</span>
            <span class="n">write</span><span class="p">(</span><span class="n">to_file</span><span class="p">,</span> <span class="n">read</span><span class="p">(</span><span class="n">from_file</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">new_lines</span>

<span class="k">if</span> <span class="n">parse</span><span class="p">:</span>
    <span class="k">global</span> <span class="n">RESOLVE_REFERENCES</span>
    <span class="n">RESOLVE_REFERENCES</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
    <span class="c">#self.resolv()</span>
</pre></div>
</div>





<h4><a id="sec3.5.1.4Extraire_les_informations_sp_cifiques_au_document">3.5.1.4. Extraire les informations spécifiques au document</a></h4>



<p>
Pour extraire les informations spécifiques au document, nous le parcourons une fois en entier, lui tirant sa substantifique moëlle. Quand une ligne est spécifique au document, nous l'analysons, et nous la retirons des lignes connues du document. À la fin de cette lecture, le document sait qui il est, ce qu'il est, et les lignes ne contiennent plus que des informations pouvant être analysées par la fonction originale de <span class="textcode"><span class="n">Section</span></span>.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="extraire_les_informations_sp_cifiques_au_document1">extraire les informations spécifiques au document</a></span> <a href="#coderef58">(58)</a> <a href="#coderef24">(24)</a> </div>
<div class="highlight"><pre><span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
</pre></div>
<div><pre>    <a id="coderef45" href="#Document.parse:_que_faire_de_cette_ligne__1">Document.parse: que faire de cette ligne ?</a></pre></div>
<div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">new_lines</span>
<span class="n">Section</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>
Nous parcourons le document ligne par ligne. Nous commençons par ignorer les blocs de code :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="Document.parse:_que_faire_de_cette_ligne__1">Document.parse: que faire de cette ligne ?</a></span><a href="#Document.parse:_que_faire_de_cette_ligne__2"> -&gt;</a> <a href="#coderef45">(45)</a> </div>
<div><pre><a id="coderef46" href="#ignorer_les_blocs_de_code1">ignorer les blocs de code</a></pre></div>
</div>
<p>
Pour rappel, voici comment est définit ce bloc de code :</p>
<div class="codechunk"><div class="codehead">Reminder for code <a href="#ignorer_les_blocs_de_code1" id="coderef47">ignorer les blocs de code</a>:</div><div class="highlight"><pre><span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;code&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
<hr><div class="highlight"><pre><span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;&lt;code&quot;</span><span class="p">):</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;code&quot;</span>
    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>
Il fonctionne car nous utilisons les mêmes variables que dans la <a href="#premi_re_d_finition_de___ignorer_les_blocs_de_code__">méthode</a> où nous l'avons définit pour la première fois.</p>



<h5><a id="sec3.5.1.4.1D_tecter_les_titres">3.5.1.4.1. Détecter les titres</a></h5>



<p>
Si la ligne est composée d'une barre d'étoiles, il y a deux solutions : soit nous sommes déjà en mode titre, et dans ce cas, nous sortons du mode titre, soit nous sommes dans un autre mode, auquel cas nous passons en mode titre (et créons un titre).</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="Document.parse:_que_faire_de_cette_ligne__2">Document.parse: que faire de cette ligne ?</a></span><a href="#Document.parse:_que_faire_de_cette_ligne__1"> &lt;-</a><a href="#Document.parse:_que_faire_de_cette_ligne__3"> -&gt;</a> <a href="#coderef45">(45)</a> </div>
<div class="highlight"><pre><span class="k">elif</span> <span class="n">star_line</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="s">&quot;title&quot;</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;title&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">Title</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">important</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
<p>
<span class="italic">Lorsque nous avons finit de créer le titre, nous vérifions s'il est important (s'il n'est pas vide). S'il ne l'est pas, nous ne le retenons pas.</span></p>
<p>
La fonction star_line est une fonction utilitaire qui prend une ligne comme paramètre, et retourne <span class="textcode"><span class="bp">True</span></span> si cette ligne est composée uniquement d'étoiles, optionellement entourée d'espaces :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="fonctions_utilitaires7">fonctions utilitaires</a></span><a href="#fonctions_utilitaires6"> &lt;-</a><a href="#fonctions_utilitaires8"> -&gt;</a> <a href="#coderef4">(4)</a> </div>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">star_line</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s">&quot;*&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>
<span class="italic">Nous commençons par retirer les espaces aux extrémités de la ligne. Ensuite, si la ligne fait moins de deux caractères, elle ne peut pas contenir une ligne d'étoiles (il faut au moins deux étoiles consécutives). Pour finir, nous vérifions que tout les caractères de la ligne sont des étoiles. Si ce n'est pas le cas, nous retournons <span class="textcode"><span class="bp">False</span></span>, sinon, notre ligne est bien une ligne d'étoiles.</span></p>
<p>
Si nous sommes en mode titre, nous ajoutons la ligne aux lignes de <span class="textcode"><span class="bp">self</span><span class="o">.</span><span class="n">title</span></span>. Pour rappel, <span class="textcode"><span class="bp">self</span><span class="o">.</span><span class="n">title</span></span> a été initialisé comme une instance de la classe <span class="textcode"><span class="n">Title</span></span>. Cette classe contient une méthode nommée <span class="textcode"><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></span>, qui prend en paramètre la ligne à ajouter et l'analyse. Ajouter notre ligne au titre est donc très simple :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="Document.parse:_que_faire_de_cette_ligne__3">Document.parse: que faire de cette ligne ?</a></span><a href="#Document.parse:_que_faire_de_cette_ligne__2"> &lt;-</a><a href="#Document.parse:_que_faire_de_cette_ligne__4"> -&gt;</a> <a href="#coderef45">(45)</a> </div>
<div class="highlight"><pre><span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;title&quot;</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>
Il est maintenant temps de vous décrire la classe <span class="textcode"><span class="n">Title</span></span>, qui n'est utilisée qu'ici, et au moment de générer la documentation (voir les sections correspondantes).</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="classes_utiles___la_classe_Document1">classes utiles à la classe Document</a></span><a href="#classes_utiles___la_classe_Document2"> -&gt;</a> <a href="#coderef21">(21)</a> </div>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Title</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">important</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef48" href="#classe_Title:_est_elle_importante__1">classe Title: est elle importante ?</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef49" href="#classe_Title:_ajouter_une_ligne1">classe Title: ajouter une ligne</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef50" href="#formater_le_titre1">formater le titre</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef51" href="#sortir_le_titre_en_HTML1">sortir le titre en HTML</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output_html_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef52" href="#sortir_le_titre_en_HTML_(_l_ment_<title>)1">sortir le titre en HTML (élément &lt;title>)</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef53" href="#afficher_la_structure_du_titre1">afficher la structure du titre</a></pre></div>
<div class="highlight"><pre>
</pre></div>
</div>
<p>
Cette classe contient uniquement un tableau, contenant chaque ligne du titre. Les fonctions <span class="textcode"><span class="n">format_text</span><span class="p">()</span></span>, <span class="textcode"><span class="n">output_html</span><span class="p">()</span></span> et <span class="textcode"><span class="n">output_html_title</span><span class="p">()</span></span> sont utilisées lors du formatage du document et de la génération de la documentation et seront décrites plus tard. La fonction <span class="textcode"><span class="n">add_line</span></span> prend une ligne en paramètre, l'analyse, et stocke la ligne dans la variable <span class="textcode"><span class="bp">self</span><span class="o">.</span><span class="n">content</span></span>. La ligne passée peut commencer par une étoile, et/ou finir par une étoile. Nous les supprimons si c'est le cas. Nous supprimons aussi les espaces avant et après ces étoiles. Ce qui donne comme fonction :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="classe_Title:_ajouter_une_ligne1">classe Title: ajouter une ligne</a></span> <a href="#coderef49">(49)</a> </div>
<div class="highlight"><pre><span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;*&quot;</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;*&quot;</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>
<span class="italic">Nous devons vérifier que la ligne n'est pas vide avant d'en supprimer une étoile, sans quoi nous risquons d'essayer d'accéder à un caractère qui n'est pas dans la chaîne (puisque la ligne est vide).</span></p>
<p>
La fonction <span class="textcode"><span class="n">important</span><span class="p">()</span></span> est utilisée lors de l'affichage, mais nous la définissons ici, car elle est assez simple. Elle consiste à vérifier si le titre est bien rempli. Si le titre ne contient que des lignes vides, il n'est pas important et nous n'aurons jamais à l'afficher. Cette fonction renvoie <span class="textcode"><span class="bp">True</span></span> si le titre est « important », <span class="textcode"><span class="bp">False</span></span> sinon.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="classe_Title:_est_elle_importante__1">classe Title: est elle importante ?</a></span> <a href="#coderef48">(48)</a> </div>
<div class="highlight"><pre><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">line</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
<span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>





<h5><a id="sec3.5.1.4.2D_tecter_le_r_sum__et_la_licence">3.5.1.4.2. Détecter le résumé et la licence</a></h5>



<p>
Le résumé comme la licence sont stockés dans une instance de la classe <span class="textcode"><span class="n">Documentation</span></span> (voir <a href="#classe_documentation">ici</a>). Lorsque nous sommes en mode licence ou en mode résumé, nous ajoutons chaque ligne à la licence/au résumé, sauf si la ligne est <span class="textcode">~~~</span>, auquel cas nous repassons en mode normal.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="Document.parse:_que_faire_de_cette_ligne__4">Document.parse: que faire de cette ligne ?</a></span><a href="#Document.parse:_que_faire_de_cette_ligne__3"> &lt;-</a><a href="#Document.parse:_que_faire_de_cette_ligne__5"> -&gt;</a> <a href="#coderef45">(45)</a> </div>
<div class="highlight"><pre><span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;license&quot;</span><span class="p">,</span> <span class="s">&quot;abstract&quot;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;~~~&quot;</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;license&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">license</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;abstract&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>
On gère maintenant le passage dans ces deux modes :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="Document.parse:_que_faire_de_cette_ligne__5">Document.parse: que faire de cette ligne ?</a></span><a href="#Document.parse:_que_faire_de_cette_ligne__4"> &lt;-</a><a href="#Document.parse:_que_faire_de_cette_ligne__6"> -&gt;</a> <a href="#coderef45">(45)</a> </div>
<div class="highlight"><pre><span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~license~&quot;</span><span class="p">):</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;license&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">license</span> <span class="o">=</span> <span class="n">Documentation</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~abstract~&quot;</span><span class="p">):</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;abstract&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span> <span class="o">=</span> <span class="n">Documentation</span><span class="p">()</span>
</pre></div>
</div>
<p>
<span class="italic">Lorsque nous passons en mode licence ou résumé, nous créons une portion de documentation pour en accueillir le contenu.</span></p>





<h5><a id="sec3.5.1.4.3D_tecter_les_auteurs">3.5.1.4.3. Détecter les auteurs</a></h5>



<p>
Comme pour le titre, une classe spéciale a été écrite pour contenir les auteurs. Quand une ligne commence par <span class="textcode">~Authors</span>, elle est passée à cette classe qui retient cette ligne après l'avoir nettoyée de cet inévitable <span class="textcode">~Authors</span> :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="Document.parse:_que_faire_de_cette_ligne__6">Document.parse: que faire de cette ligne ?</a></span><a href="#Document.parse:_que_faire_de_cette_ligne__5"> &lt;-</a><a href="#Document.parse:_que_faire_de_cette_ligne__7"> -&gt;</a> <a href="#coderef45">(45)</a> </div>
<div class="highlight"><pre><span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~authors&quot;</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>
La classe <span class="textcode"><span class="n">Authors</span></span> est définie ainsi :</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="classes_utiles___la_classe_Document2">classes utiles à la classe Document</a></span><a href="#classes_utiles___la_classe_Document1"> &lt;-</a><a href="#classes_utiles___la_classe_Document3"> -&gt;</a> <a href="#coderef21">(21)</a> </div>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Authors</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef54" href="#formater_les_balises_des_auteurs1">formater les balises des auteurs</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef55" href="#sortir_les_auteurs_en_HTML1">sortir les auteurs en HTML</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output_html_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef56" href="#sortir_les_auteurs_en_HTML_(balise_<meta>)1">sortir les auteurs en HTML (balise &lt;meta>)</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef57" href="#afficher_la_structure_des_auteurs1">afficher la structure des auteurs</a></pre></div>
<div class="highlight"><pre>
</pre></div>
</div>
<p>
La classe <span class="textcode"><span class="n">Authors</span></span> possède une méthode <span class="textcode"><span class="n">add_line</span></span>. Cette méthode prend comme paramètre une ligne, en supprime le début (qui contient <span class="textcode">~Authors</span>), et l'ajoute dans la liste des auteurs – si aucun auteur portant ce nom n'a encore été ajouté.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="classes_utiles___la_classe_Document3">classes utiles à la classe Document</a></span><a href="#classes_utiles___la_classe_Document2"> &lt;-</a> <a href="#coderef21">(21)</a> </div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>





<h5><a id="sec3.5.1.4.4D_tecter_le_langage_du_document">3.5.1.4.4. Détecter le langage du document</a></h5>



<p>
La dernière information à extraire est le langage de programmation principal du document. Ce langage est stocké dans la variable globale <span class="textcode"><span class="n">DOCUMENT_LANGUAGE</span></span>.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="Document.parse:_que_faire_de_cette_ligne__7">Document.parse: que faire de cette ligne ?</a></span><a href="#Document.parse:_que_faire_de_cette_ligne__6"> &lt;-</a><a href="#Document.parse:_que_faire_de_cette_ligne__8"> -&gt;</a> <a href="#coderef45">(45)</a> </div>
<div class="highlight"><pre><span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~code&quot;</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">DOCUMENT_LANGUAGE</span>
    <span class="n">DOCUMENT_LANGUAGE</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>





<h5><a id="sec3.5.1.4.5Retenir_les_autres_lignes">3.5.1.4.5. Retenir les autres lignes</a></h5>



<p>
Nous terminons cette portion de code en retenant les lignes qui n'ont pas été gérées : elles ne font pas partie des attributs du document, mais de la section.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="Document.parse:_que_faire_de_cette_ligne__8">Document.parse: que faire de cette ligne ?</a></span><a href="#Document.parse:_que_faire_de_cette_ligne__7"> &lt;-</a> <a href="#coderef45">(45)</a> </div>
<div class="highlight"><pre><span class="k">else</span><span class="p">:</span>
    <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>





<h5><a id="sec3.5.1.4.6R_sum_">3.5.1.4.6. Résumé</a></h5>



<p>
Voici au final à quoi ressemble la fonction qui extrait les informations spécifiques au document :</p>
<div class="codechunk"><div class="codehead">Output of code <a href="#extraire_les_informations_sp_cifiques_au_document1" id="coderef58">extraire les informations spécifiques au document</a>:</div><div class="highlight"><pre><span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;code&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;&lt;code&quot;</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;code&quot;</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">star_line</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="s">&quot;title&quot;</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;title&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">Title</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">important</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;title&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;license&quot;</span><span class="p">,</span> <span class="s">&quot;abstract&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;~~~&quot;</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;license&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">license</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;abstract&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~license~&quot;</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;license&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">license</span> <span class="o">=</span> <span class="n">Documentation</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~abstract~&quot;</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;abstract&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span> <span class="o">=</span> <span class="n">Documentation</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~authors&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~code&quot;</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">DOCUMENT_LANGUAGE</span>
        <span class="n">DOCUMENT_LANGUAGE</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">new_lines</span>
<span class="n">Section</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>









<h3><a id="sec3.5.2La_classe_Section">3.5.2. La classe Section</a></h3>



<p>
<a id="self.lines_dans_les_sections"></a></p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="classe_Section1">classe Section</a></span> <a href="#coderef19">(19)</a> </div>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Section</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef59" href="#attributs_d_une_section1">attributs d'une section</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef60" href="#d_composer_une_section1">décomposer une section</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef61" href="#formater_une_section1">formater une section</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">output_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef62" href="#sortir_une_section_en_HTML1">sortir une section en HTML</a></pre></div>
<div class="highlight"><pre>    <span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef63" href="#afficher_la_structure_d_une_section1">afficher la structure d'une section</a></pre></div>
</div>
<p>
<span class="italic">Lors de l'initialisation d'une section, on peut lui donner deux paramètres. <span class="textcode"><span class="n">parent</span></span> permet de savoir de quelle section la section courante est une sous-section, et <span class="textcode"><span class="n">name</span></span> permet de connaître le nom de la section.</span></p>
<p>
Une section est décomposée en deux parties : son introduction, et ses sous-sections. Une section possède aussi un titre, et une position, indiquant le numéro de la section dans sa section parente. Nous retenons le contenu de la section non-parsée dans la variable <span class="textcode"><span class="bp">self</span><span class="o">.</span><span class="n">lines</span></span>. Nous retenons aussi la section parente de notre section, afin de pouvoir trouver, pour une section, quelle est sa place dans le document entier.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="attributs_d_une_section1">attributs d'une section</a></span> <a href="#coderef59">(59)</a> </div>
<div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
<span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
<span class="bp">self</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
<span class="bp">self</span><span class="o">.</span><span class="n">introduction</span> <span class="o">=</span> <span class="n">Introduction</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="bp">self</span><span class="o">.</span><span class="n">original_depth</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>
<span class="italic"><span class="textcode"><span class="bp">self</span><span class="o">.</span><span class="n">original_depth</span></span> nous permet de conserver la profondeur originale d'un titre, même s'il est moins profond dans la structure du document. Ainsi, un document ne comprenant comme seul titre que <span class="textcode">=== Titre</span> affichera « Titre » au premier niveau, mais lors du formatage, restitueras les trois signes égal. Nous faisons ceci car lorsque nous incluons des fichiers, au moment du formatage, nous parsons leurs titres comme étant de premier niveau, mais voulons les formater à leur profondeur réelle.</span></p>
<p>
L'analyse d'une section consiste en une action très simple : séparer l'introduction des sous-sections, et créer les sous-sections. Pour cela, nous lisons chaque ligne, et l'ajoutons à l'introduction. Si une ligne débute par le signe <span class="textcode"><span class="o">=</span></span>, nous considérons que nous débutons une sous-section. Comme dans la classe <span class="textcode"><span class="n">Document</span></span>, nous ignorons le contenu des blocs de code.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="d_composer_une_section1">décomposer une section</a></span> <a href="#coderef60">(60)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>





<h3><a id="sec3.5.3La_classe_Introduction">3.5.3. La classe Introduction</a></h3>



<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="classe_Introduction1">classe Introduction</a></span> <a href="#coderef18">(18)</a> </div>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Introduction</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>







<h2><a id="sec3.6Gestion_des_blocs_de_code">3.6. Gestion des blocs de code</a></h2>



<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="gestion_des_blocs_de_code1">gestion des blocs de code</a></span> <a href="#coderef7">(7)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
</pre></div>
</div>





<h2><a id="sec3.7Gestion_de_la_documentation">3.7. Gestion de la documentation</a></h2>



<p>
<a id="classe_documentation"></a></p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="gestion_des_blocs_de_documentation1">gestion des blocs de documentation</a></span> <a href="#coderef8">(8)</a> </div>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Documentation</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
</pre></div>
<div><pre>        <a id="coderef64" href="#afficher_la_structure_d_une_portion_de_documentation1">afficher la structure d'une portion de documentation</a></pre></div>
</div>
<p>
<span class="italic">La fonction <span class="textcode"><span class="n">print_debug</span></span> de la portion de documentation peut prendre en paramètre un faux nom qu'elle affichera au lieu du nom de la classe (<span class="textcode"><span class="n">Documentation</span></span>). Ce paramètre est utilisé pour afficher la licence et le résumé du document avec un nom correct.</span></p>





<h2><a id="sec3.8Afficher_la_structure_du_document">3.8. Afficher la structure du document</a></h2>



<p>
Pour afficher la structure du document, nous allons utiliser une fonction d'affichage spéciale. Cette fonction prend trois paramètres. Ces trois paramètres sont :</p>
<ul><li><p>
l'objet de la structure que l'on va afficher,</p>
</li><li><p>
la profondeur de cet objet,</p>
</li><li><p>
le nom de l'objet, s'il ne correspond pas à celui de la classe.</p>
</li></ul>
<p>
Le dernier argument est optionnel.</p>
<p>
La fonction va afficher le nom de l'objet, puis une série de dièses indiquant la profondeur de l'objet, permettant de mettre en avant la hierarchie du document. Enfin, elle affiche le texte contenu de l'objet si celui-ci est une chaîne de caractère. La chaine affichée à l'écran ne fera pas plus de la taille spécifiée pour un document (contenue dans la variable globale <span class="textcode"><span class="n">DOCUMENT_WIDTH</span></span>).</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="fonctions_utilitaires8">fonctions utilitaires</a></span><a href="#fonctions_utilitaires7"> &lt;-</a><a href="#fonctions_utilitaires9"> -&gt;</a> <a href="#coderef4">(4)</a> </div>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">deep</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">meta</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">meta</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;unicode&quot;</span><span class="p">]:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">deep</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s">u&quot;[</span><span class="si">%s</span><span class="s">]</span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">DOCUMENT_WIDTH</span><span class="p">]</span>
    <span class="k">print</span> <span class="n">line</span>
</pre></div>
</div>
<p>
La fonction <span class="textcode"><span class="n">meta</span><span class="p">()</span></span><a href="#ref10" id="toref10"><sup>10</sup></a> permet de récupérer le nom de la classe d'un objet. Pour ce faire, nous récupérons la classe de l'objet avec l'attribut <span class="textcode"><span class="n">__class__</span></span>, et le nom de cette classe avec son attribut <span class="textcode"><span class="n">__name__</span></span>.</p>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="fonctions_utilitaires9">fonctions utilitaires</a></span><a href="#fonctions_utilitaires8"> &lt;-</a> <a href="#coderef4">(4)</a> </div>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">meta</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="afficher_la_structure_d_un_document1">afficher la structure d'un document</a></span> <a href="#coderef27">(27)</a> </div>
<div class="highlight"><pre><span class="n">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">print_debug</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">print_debug</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">print_debug</span><span class="p">(</span><span class="n">DOCUMENT_LANGUAGE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Code Definition&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span><span class="o">.</span><span class="n">print_debug</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Abstract&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
    <span class="n">section</span><span class="o">.</span><span class="n">print_debug</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">license</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">license</span><span class="o">.</span><span class="n">print_debug</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;License&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="afficher_la_structure_du_titre1">afficher la structure du titre</a></span> <a href="#coderef53">(53)</a> </div>
<div class="highlight"><pre><span class="n">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">deep</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="afficher_la_structure_des_auteurs1">afficher la structure des auteurs</a></span> <a href="#coderef57">(57)</a> </div>
<div class="highlight"><pre><span class="n">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">)</span>
<span class="k">for</span> <span class="n">authors</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="n">deep</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="afficher_la_structure_d_une_section1">afficher la structure d'une section</a></span> <a href="#coderef63">(63)</a> </div>
<div class="highlight"><pre><span class="k">print</span> <span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">)</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="afficher_la_structure_d_une_portion_de_documentation1">afficher la structure d'une portion de documentation</a></span> <a href="#coderef64">(64)</a> </div>
<div class="highlight"><pre><span class="n">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
    <span class="n">print_debug</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">deep</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>
<span class="italic">La fonction <span class="textcode"><span class="n">debug_print</span><span class="p">()</span></span> de la classe <span class="textcode"><span class="n">Documentation</span></span> prend en paramètre <span class="textcode"><span class="n">name</span> <span class="o">=</span> <span class="bp">None</span></span>. Ceci permet d'afficher un bloc de documentation en mentant sur le nom, comme on a fait avec le résumé et la licence.</span></p>





<h2><a id="sec3.9Formater_les_documents_source">3.9. Formater les documents source</a></h2>



<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="formater_un_document1">formater un document</a></span> <a href="#coderef25">(25)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="formater_le_titre1">formater le titre</a></span> <a href="#coderef50">(50)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="formater_les_balises_des_auteurs1">formater les balises des auteurs</a></span> <a href="#coderef54">(54)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="formater_une_section1">formater une section</a></span> <a href="#coderef61">(61)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>





<h2><a id="sec3.10Sortie_HTML_du_document">3.10. Sortie HTML du document</a></h2>



<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="variables_template1">variables template</a></span> <a href="#coderef11">(11)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="sortir_un_document_en_html1">sortir un document en html</a></span> <a href="#coderef26">(26)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="sortir_le_titre_en_HTML1">sortir le titre en HTML</a></span> <a href="#coderef51">(51)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="sortir_le_titre_en_HTML_(_l_ment_<title>)1">sortir le titre en HTML (élément &lt;title>)</a></span> <a href="#coderef52">(52)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="sortir_les_auteurs_en_HTML1">sortir les auteurs en HTML</a></span> <a href="#coderef55">(55)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="sortir_les_auteurs_en_HTML_(balise_<meta>)1">sortir les auteurs en HTML (balise &lt;meta>)</a></span> <a href="#coderef56">(56)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code : <span class="\codename"><a id="sortir_une_section_en_HTML1">sortir une section en HTML</a></span> <a href="#coderef62">(62)</a> </div>
<div class="highlight"><pre><span class="c"># TODO</span>
<span class="k">pass</span>
</pre></div>
</div>





<h2><a id="sec3.11Code_final">3.11. Code final</a></h2>



<p>
Voici à quoi ressemble le code une fois totalement assemblé :</p>
<div class="codechunk"><div class="codehead">Output of code <a href="#lpm1" id="coderef65">lpm</a>:</div><div class="highlight"><pre><span class="c">#!/usr/bin/env python2</span>
<span class="c"># -*- encoding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

<span class="n">DOCUMENT_WIDTH</span> <span class="o">=</span> <span class="mi">72</span>
<span class="n">INDENTATION</span> <span class="o">=</span> <span class="s">&quot;    &quot;</span>
<span class="n">MARGINS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">INDENTATION</span><span class="p">)</span>
<span class="n">DOCUMENT_LANGUAGE</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>

<span class="n">NOTEREFS</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">URLREFS</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">CODEREFS</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">FOOTNOTES</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">FOOTURLS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">CODE</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">RESOLVE_REFERENCES</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">COLOR_ERRORS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">CODEREF_ERRORS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c"># TODO</span>

<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8&quot;</span><span class="p">):</span>
	<span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">readlines</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8&quot;</span><span class="p">):</span>
	<span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s">&quot;utf-8&quot;</span><span class="p">):</span>
	<span class="c">#f = codecs.open(filename, &#39;w&#39;, encoding = encoding)</span>
	<span class="c">#f.write(text)</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="o">+</span><span class="s">u&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">split_path</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">escaping</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">word</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">escaping</span><span class="p">:</span> 
            <span class="n">word</span> <span class="o">+=</span> <span class="n">c</span>
            <span class="n">escaping</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="n">escaping</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
            <span class="n">word</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">texts</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">texts</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span> <span class="o">==</span> <span class="n">text</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">star_line</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s">&quot;*&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">deep</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">meta</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">meta</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;unicode&quot;</span><span class="p">]:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span>
    <span class="n">indent</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">deep</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s">u&quot;[</span><span class="si">%s</span><span class="s">]</span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">DOCUMENT_WIDTH</span><span class="p">]</span>
    <span class="k">print</span> <span class="n">line</span>
<span class="k">def</span> <span class="nf">meta</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>


<span class="c"># TODO</span>
<span class="k">class</span> <span class="nc">Documentation</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">print_debug</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">deep</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Introduction</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Section</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">introduction</span> <span class="o">=</span> <span class="n">Introduction</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_depth</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">output_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Title</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">important</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;*&quot;</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;*&quot;</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">output_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">output_html_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">):</span>
        <span class="n">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">print_debug</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">deep</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Authors</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">output_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">output_html_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">):</span>
        <span class="n">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">authors</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">print_debug</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="n">deep</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">parse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="n">Section</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authors</span> <span class="o">=</span> <span class="n">Authors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">license</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">dir_name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">readlines</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span>
        <span class="n">output_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_text</span><span class="p">()</span>
        <span class="n">input_text</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_text</span> <span class="o">!=</span> <span class="n">input_text</span><span class="p">:</span>
            <span class="n">write</span><span class="p">(</span><span class="n">file_name</span><span class="o">+</span><span class="s">&quot;.clean&quot;</span><span class="p">,</span> <span class="n">output_text</span><span class="p">)</span>
        
        <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;code&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;&lt;code&quot;</span><span class="p">):</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;code&quot;</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~get&quot;</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">get_file</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">get_file_abs</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">get_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">get_file</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">error</span><span class="p">(</span><span class="s">&quot;Un get n&#39;a pas d&#39;argument.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">get_file_abs</span><span class="p">):</span>
                    <span class="n">error</span><span class="p">(</span><span class="s">&quot;Fichier non trouvé : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">get_file_abs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">get_file_abs</span><span class="p">,</span> <span class="n">parse</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                    <span class="n">new_lines</span> <span class="o">+=</span> <span class="n">document</span><span class="o">.</span><span class="n">lines</span>
            <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~include&quot;</span><span class="p">):</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;~include &quot;</span><span class="o">+</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~image&quot;</span><span class="p">):</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;~image &quot;</span><span class="o">+</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~copy&quot;</span><span class="p">):</span>
                <span class="n">files</span> <span class="o">=</span> <span class="n">split_path</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">from_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">to_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">from_file</span><span class="p">):</span>
                    <span class="n">error</span><span class="p">(</span><span class="s">&quot;Fichier non trouvé : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">from_file</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to_file</span><span class="p">)):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to_file</span><span class="p">))</span>
                    <span class="n">write</span><span class="p">(</span><span class="n">to_file</span><span class="p">,</span> <span class="n">read</span><span class="p">(</span><span class="n">from_file</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">new_lines</span>
        
        <span class="k">if</span> <span class="n">parse</span><span class="p">:</span>
            <span class="k">global</span> <span class="n">RESOLVE_REFERENCES</span>
            <span class="n">RESOLVE_REFERENCES</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
            <span class="c">#self.resolv()</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;code&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;&lt;code&quot;</span><span class="p">):</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;code&quot;</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">star_line</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="s">&quot;title&quot;</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;title&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">Title</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">important</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;title&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;license&quot;</span><span class="p">,</span> <span class="s">&quot;abstract&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;~~~&quot;</span><span class="p">:</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;license&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">license</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;abstract&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~license~&quot;</span><span class="p">):</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;license&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">license</span> <span class="o">=</span> <span class="n">Documentation</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~abstract~&quot;</span><span class="p">):</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s">&quot;abstract&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span> <span class="o">=</span> <span class="n">Documentation</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~authors&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">begin</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;~code&quot;</span><span class="p">):</span>
                <span class="k">global</span> <span class="n">DOCUMENT_LANGUAGE</span>
                <span class="n">DOCUMENT_LANGUAGE</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="n">new_lines</span>
        <span class="n">Section</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">output_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ebook</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">print_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">print_debug</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">print_debug</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">print_debug</span><span class="p">(</span><span class="n">DOCUMENT_LANGUAGE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Code Definition&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span><span class="o">.</span><span class="n">print_debug</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Abstract&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="n">section</span><span class="o">.</span><span class="n">print_debug</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">license</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">license</span><span class="o">.</span><span class="n">print_debug</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;License&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
	<span class="n">error</span><span class="p">(</span><span class="s">u&quot;Erreur : aucun fichier passé en paramètre&quot;</span><span class="p">)</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="n">document_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">document_file</span><span class="p">):</span>
	<span class="n">error</span><span class="p">(</span><span class="s">u&quot;</span><span class="si">%s</span><span class="s"> n&#39;existe pas.&quot;</span> <span class="o">%</span> <span class="n">document_file</span><span class="p">)</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="n">project</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">document_file</span><span class="p">)</span>
<span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">html_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="n">project</span><span class="o">+</span><span class="s">&quot;.html&quot;</span><span class="p">)</span>
<span class="n">ebook_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="n">project</span><span class="o">+</span><span class="s">&quot;.ebook_ready.html&quot;</span><span class="p">)</span>

<span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">document_file</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">CODE</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">CODE</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">referenced</span><span class="p">:</span>
        <span class="n">source_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">write</span><span class="p">(</span><span class="n">source_file</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CODE</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resolved</span><span class="p">))</span>
<span class="n">write</span><span class="p">(</span><span class="n">html_file</span><span class="p">,</span> <span class="n">document</span><span class="o">.</span><span class="n">output_html</span><span class="p">())</span>
<span class="n">write</span><span class="p">(</span><span class="n">ebook_file</span><span class="p">,</span> <span class="n">document</span><span class="o">.</span><span class="n">output_html</span><span class="p">(</span><span class="n">ebook</span> <span class="o">=</span> <span class="bp">True</span><span class="p">))</span>
<span class="n">document</span><span class="o">.</span><span class="n">print_debug</span><span class="p">()</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">COLOR_ERRORS</span><span class="p">:</span>
    <span class="n">error</span><span class="p">(</span><span class="s">u&quot;Pas de coloration syntaxique pour le langage </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">CODEREF_ERRORS</span><span class="p">:</span>
    <span class="n">error</span><span class="p">(</span><span class="s">u&quot;&lt;Code: </span><span class="si">%s</span><span class="s"> n&#39;existe pas.&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>







<h1><a id="sec4Un_fichier_pour_tester_le_programme">4. Un fichier pour tester le programme</a></h1>



<p>
Nous allons ici créer un document permettant de tester les fonctionnalités du programme.</p>
<p>
Ce document sera composé de trois fichiers, permettant ainsi de tester les commandes d'inclusion de fichier.</p>
<p>
Le premier fichier sera nommé <span class="italic">test</span> et placé dans un dossier <span class="italic">tests</span>. Son titre tiendra sur plusieurs lignes afin de vérifier la génération de cadre autour de celui-ci.</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test1">tests/test</a></span><a href="#tests/test2"> -&gt;</a> </div>
<div class="highlight"><pre>**
* Le titre du document :
* Ce document est un document de test
*
* Avec un titre chiant
*
**
</pre></div>
</div>
<p>
Ce fichier contiendra, pour la forme, majoritairement du python. Il sera écrit par deux individus nommés Tartempion et Mélanine de Balzac :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test2">tests/test</a></span><a href="#tests/test1"> &lt;-</a><a href="#tests/test3"> -&gt;</a> </div>
<div class="highlight"><pre>~Authors Tartempion
~Authors Mélanine de Balzac
~Code python
</pre></div>
</div>
<p>
Le résumé contiendra deux lorem ipsum, dont un sera considéré comme important :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test3">tests/test</a></span><a href="#tests/test2"> &lt;-</a><a href="#tests/test4"> -&gt;</a> </div>
<div class="highlight"><pre>~abstract~
/!\Lorem     ipsum   dolor   sit amet, consectetur adipiscing elit.
Etiam neque lectus, iaculis vel fringilla varius, molestie vitae lorem.
Nunc sed porttitor orci.  Nullam mattis gravida tellus, et hendrerit
libero porttitor eget. Nam blandit, sapien in molestie suscipit, metus
sapien tincidunt sem, id imperdiet eros orci ac risus. Nunc vel est
enim. Vestibulum blandit, leo ac luctus lobortis, lectus nunc faucibus
nisl, quis interdum augue lectus bibendum orci. Morbi in rutrum ante.
Donec accumsan est vel tellus viverra euismod at eu tortor. Nam justo
ligula, faucibus ac eleifend vitae, dignissim vitae augue. Sed eget urna
venenatis nisi aliquet pulvinar nec eu nulla. Etiam porta placerat nisi
sit amet laoreet. Praesent sollicitudin suscipit vestibulum. Proin non
elementum ipsum. Duis quis risus posuere purus pellentesque placerat in
vitae tortor.  Morbi a massa gravida nibh ullamcorper interdum. Aenean
ac sapien nec sapien pharetra ullamcorper.

Aliquam dictum facilisis enim sit amet convallis. Curabitur placerat
nunc sit amet risus mollis pretium aliquam neque ultrices. Vestibulum
pretium, nisl posuere fringilla semper, eros ipsum congue eros, bibendum
vestibulum mauris orci sit amet diam. Ut sed lectus eget quam tristique
egestas at a justo. Duis in molestie mi. Maecenas viverra adipiscing
nunc, sed facilisis nulla accumsan rutrum. Mauris mattis fermentum nulla
sit amet cursus. Proin purus magna, euismod a condimentum vitae, posuere
sit amet dui. Vivamus molestie lectus non quam viverra non tristique
tellus pellentesque. Proin porta consequat sem eu bibendum. In at magna
nisi.
~~~
</pre></div>
</div>
<p>
Ensuite, nous créons une section, et une sous-section :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test4">tests/test</a></span><a href="#tests/test3"> &lt;-</a><a href="#tests/test5"> -&gt;</a> </div>
<div class="highlight"><pre>= Section

Introduction de la section

== Sous-section
</pre></div>
</div>
<p>
Cette sous-section contiendra encore des sous-sections testant le fonctionnement des listes :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test5">tests/test</a></span><a href="#tests/test4"> &lt;-</a><a href="#tests/test6"> -&gt;</a> </div>
<div class="highlight"><pre>=== Listes

==== Listes non-numérotées

- Les listes non numérotées
- Les autres

==== Listes numérotées
Ou, si vous préférez :
# Les listes numérotées
# Les autres

==== Imbrication de listes
Il y a aussi :
- des listes numérotées dans des listes non numérotées
&#39; # avec plusieurs éléments
&#39; # comme ça
- des listes non numérotées dans des listes numérotées
&#39; - avec autant d&#39;éléments
&#39; - que précédemment
# et aussi des liste non numérotées
&#39; dans des listes numérotées
&#39; - de ce style
# Puis pour ne pas surprendre :
&#39; # des liste numérotées dans des
&#39; &#39; listes numérotées
# Et un élément très très très très long pour voir comment les retours
&#39; à la ligne sont gérés. Et qui en plus contient
&#39;
&#39; /!\ un paragraphe important.
</pre></div>
</div>
<p>
Nous testons ensuite les références (notes de bas de page et URLs) :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test6">tests/test</a></span><a href="#tests/test5"> &lt;-</a><a href="#tests/test7"> -&gt;</a> </div>
<div class="highlight"><pre>== Renvois
Il y a les notes de bas de page*, les liens[..], les (liens ancrés)[une 
ancre] qui peuvent contenir plusieurs mots.

*: Comme ça
..: http://fr.wikipedia.org/wiki/Lien_hypertexte

Nulla aliquet adipiscing justo, ultricies blandit erat congue at. Sed
sapien dui, convallis et sollicitudin ac, volutpat ut diam. Cras sed
consequat ipsum.  Sed commodo sodales leo nec tempus. Pellentesque id
nisi dui. Nam in est accumsan odio sagittis scelerisque sed at nibh.
Pellentesque vulputate sodales risus, et auctor erat imperdiet at. Sed
malesuada, nunc vitae faucibus cursus, turpis nulla fringilla sapien,
nec varius nisl dolor a nunc. Vivamus sed tellus tortor, in aliquet
odio.

L&#39;ancre renvoie ici[=une ancre].
</pre></div>
</div>
<p>
Nous présentons ensuite différentes manière de formater les paragraphes et le texte qu'ils contiennent :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test7">tests/test</a></span><a href="#tests/test6"> &lt;-</a><a href="#tests/test8"> -&gt;</a> </div>
<div class="highlight"><pre>== La gueule des paragraphes et du texte

/!\ Les paragraphes peuvent être formatés pour être rendus plus
importants. /!\
/!\
/!\ Praesent tincidunt posuere velit. Fusce sed eros sed turpis lacinia
rhoncus. Suspendisse potenti. Nulla feugiat, nisi vitae egestas
tincidunt, tortor sapien porta risus, id scelerisque quam massa a
lectus. Etiam et sapien orci. Donec convallis lorem quis eros tincidunt
rutrum eu sit amet lectus.  Donec eget facilisis nunc. Nulla aliquam
nibh eget dolor vestibulum non placerat lacus aliquet. Curabitur
viverra, quam non luctus porttitor, lacus ipsum egestas risus, et luctus
dui diam et ligula. Quisque nulla augue, semper nec commodo vel,
consequat eget neque. Integer volutpat, mi eget interdum lobortis, lorem
ligula accumsan elit, at imperdiet tellus turpis sit amet justo.

/!\ Les deux paragraphes précédents sont dans un seul bloc important,
mais celui-ci en est séparé.

Les mots peuvent être **gras**, //italiques//, __soulignés__ ou
--barrés--.
</pre></div>
</div>
<p>
Nous pouvons aussi insérer des images. Pour cela, nous devons avoir placé une image dans le repertoire de test :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test8">tests/test</a></span><a href="#tests/test7"> &lt;-</a><a href="#tests/test9"> -&gt;</a> </div>
<div class="highlight"><pre>~Image ./image.jpg
</pre></div>
</div>
<p>
Nous parlons ensuite des blocs de code :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test9">tests/test</a></span><a href="#tests/test8"> &lt;-</a><a href="#tests/test10"> -&gt;</a> </div>
<div class="highlight"><pre>= Code
Dans cette partie, nous traiterons de la gestion du code dans le
document

&lt;Code: test.py
&quot;&quot;&quot; Ce code sera extrait dans le fichier test.py, et formaté en python
&quot;&quot;&quot;
def a():
    &lt;morceau de python
a()
&gt;

&lt;Code: test.py
&quot;&quot;&quot; Ce code sera ajouté à la suite de test.py &quot;&quot;&quot;
&gt;

&lt;Code: test.c
/* Ce code sera extrait dans test.c, mais formaté en python */
&gt;

&lt;Code (c): test2.c
/* Ce code sera extrait dans test2.c, et formaté en C */
printf(&quot;une ligne\n&quot;);
&gt;

&lt;Code: morceau de python
print &quot;L&#39;indentation est conservée&quot;
&gt;

&lt;Code:
&quot;&quot;&quot; 
Ce morceau de code affiche du python, mais n&#39;est jamais extrait de
ce
document
&quot;&quot;&quot;
&gt;

&lt;Code (lpm):
\&lt;Code:
= Explication
Voici comment on inclue un bloc de code :
\\&lt;Code:
coco
\\&gt;
Plein de retours à la ligne :



\&gt;
&gt;
</pre></div>
</div>
<p>
Nous abordons ensuite le thème des rappels de code :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test10">tests/test</a></span><a href="#tests/test9"> &lt;-</a><a href="#tests/test11"> -&gt;</a> </div>
<div class="highlight"><pre>La commande \~Remain rappelle un morceau de code, la commande \~Display
affiche un morceau de code (dans le premier cas, on affiche ce qui a
déjà été affiché, dans le second, on affiche le code tel qu&#39;il sera
sortit)

Remain :
~Remain test.py

Display :
~Display test.py
</pre></div>
</div>
<p>
Puis nous parlons des morceaux de code dans les paragraphes :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test11">tests/test</a></span><a href="#tests/test10"> &lt;-</a><a href="#tests/test12"> -&gt;</a> </div>
<div class="highlight"><pre>On peut mettre des blocs de --code **dans un** paragraphe-- 
(&lt;import os&gt;), spécifier le langage (&lt;&lt;c&gt;#include \&lt;stdio.h\&gt;&gt;), et
échapper les caractères qui sont utilisés par lpm
(&lt;\&lt;\&lt;python\&gt;--test\&gt;&gt;). On peut aussi finir un bloc de code par \\ en
l&#39;échappant : &lt;test \\&gt;.
</pre></div>
</div>
<p>
Enfin, notre dernier travail consiste à tester les inclusions de fichier :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test12">tests/test</a></span><a href="#tests/test11"> &lt;-</a> </div>
<div class="highlight"><pre>= Inclusion de fichiers
On peut insérer un fichier sans le parser :

~Include test2.txt

Ou en le parsant :

~Get test2.txt

Et on peut insérer un fichier das le code source généré.
~Copy image.jpg data/lolcat3\ avec\ espaces.jpg
</pre></div>
</div>
<p>
Nous créons ici nos deux autres fichier, dont le premier va inclure le second afin de tester les inclusions de fichier récursives :</p>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test2.txt1">tests/test2.txt</a></span> </div>
<div class="highlight"><pre>===Une sous section à insérer

/!\ Contenant un paragraphe important.

~Get test3.txt
</pre></div>
</div>
<div class="codechunk"><div class="codehead">Code <span class="codelang">(lpm)</span>: <span class="\codename"><a id="tests/test3.txt1">tests/test3.txt</a></span> </div>
<div class="highlight"><pre>~license~
__**LRL Recursive Licence**__

Copyright Tartempion (c) 1850
Copyright Mélanine de Balzac (c) 1786

Permission is granted to use, copy, modify and/or distribute this work
as long as :

# You follow the license

This license is under LRL Recursive license.
~~~
</pre></div>
</div>


<div class="license">
<h1>License</h1>




<p>
<span class="underline"><span class="bold">LRL Recursive License</span></span></p>
<p>
<span class="italic">Copyright Dorian Trupin <span class="textcode"><span class="n">daeldir</span><span class="nd">@gmail.com</span></span> © 2012, 2013</span></p>
<p>
Permission is granted to use, copy, modify and/or distribute this work as long as:</p>
<ol><li><p>
You follow the license</p>
</li></ol>
<p>
This license is under LRL Recursive license.</p>
<p>
<span class="italic">This software is provided with the guarantee that it will fail some day. Use it at your own risk.</span></p>

</div>

<hr><p>
<a href="#toref1" id="ref1">^ 1:</a> The source file of the documentation is formatted to fit in 72 columns (72 characters max in a line). The paragraph text is justified. Code blocks are not changed, even if they do not fit in 72 characters.<p>
<p>
<a href="#toref2" id="ref2">^ 2:</a> But not always. Commands about references usually begin with the same symbole as the one used to refer to them.<p>
<p>
<a href="#toref3" id="ref3">^ 3:</a> It will be output, but only because the code that include it, <span class="italic">test.c</span>, is itself output into a file.<p>
<p>
<a href="#toref4" id="ref4">^ 4:</a> That's a LPM source code, not a C source code.<p>
<p>
<a href="#toref5" id="ref5">^ 5:</a> That feature is really useful on environments like Windows, where the command line is awful.<p>
<p>
<a href="#toref6" id="ref6">^ 6:</a> A <span class="italic">.clean</span> is well formatted only if it is the same, word by, word, as the original source file, which will not be the case if the former has syntax errors: the <span class="italic">.clean</span> being generated from the parsed representation of the document, parsing errors will be reflected in the <span class="italic">.clean</span>. In the worst case, entire paragraphs can disappear<a href="#ref7" id="toref7"><sup>7</sup></a>. A syntax error on your side can be considered by the program as correct, but parsed differently from what you intended. So, this case is difficult to avoid.<p>
<p>
<a href="#toref7" id="ref7">^ 7:</a> It happened in the first iterations of LPM. I did not stumble upon that case again, but it may be because I learned to avoid it rather than because the software has been corrected.<p>
<p>
<a href="#toref8" id="ref8">^ 8:</a> Les fichiers <span class="italic">.clean</span> sont générés dès l'analyse du document, il n'y a pas besoin de les créer explicitement ici.<p>
<p>
<a href="#toref9" id="ref9">^ 9:</a> Nous désirons, pour le formatage du fichier source lui même, ignorer les <span class="textcode">~Get</span>. Pour cette raison, nous analysons deux fois le fichier. Une fois sans avoir remplacé les <span class="textcode">~Get</span>, et une fois en l'ayant fait. Nous ne résolvons les références qu'à la deuxième analyse.<p>
<p>
<a href="#toref10" id="ref10">^ 10:</a> Le choix du nom <span class="italic">meta</span> est dû au fait que parmis les trois noms trouvés pour cette fonction, aucun ne convenait : <span class="textcode"><span class="n">class_name</span></span> est trop long (nous allons utiliser cette fonction ailleurs), <span class="textcode"><span class="k">class</span></span> est un mot reservé, <span class="textcode"><span class="n">name</span></span> est trop générique (utilisé, par exemple, comme argument de fonctions…). <span class="textcode"><span class="n">meta</span></span> permet de connaître le nom de la classe d'un objet en l'inspectant. On utilise donc l'introspection pour connaître la nature de l'objet. Si <span class="italic">meta</span> n'est pas le mot le plus pertinent, c'est néanmoins le plus pratique, sans être totalement hors-sujet.<p>
</body></html>